  [1m[35m (2.4ms)[0m  [1m[34mSELECT GET_LOCK('5328620127835068540', 0)[0m
  [1m[35m (40.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateAccounts (20230701100959)
  [1m[35m (233.2ms)[0m  [1m[35mCREATE TABLE `accounts` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `status` int DEFAULT 0 NOT NULL COMMENT 'account status', `balance` float(24) DEFAULT 0.0 NOT NULL COMMENT 'balance', `user_id` int DEFAULT 0 NOT NULL COMMENT 'related user id', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (5.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701100959')[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateUsers (20230701101004)
  [1m[35m (53.0ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `name` varchar(255) DEFAULT '' NOT NULL COMMENT 'user name', `email` varchar(255) DEFAULT '' NOT NULL COMMENT 'email', `phone` int DEFAULT 0 NOT NULL COMMENT 'phone', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101004')[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePayments (20230701101455)
  [1m[35m (43.6ms)[0m  [1m[35mCREATE TABLE `payments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `account_id` int NOT NULL COMMENT 'related account id', `order_id` int NOT NULL COMMENT 'related order id', `status` int DEFAULT 0 NOT NULL COMMENT 'payment status', `amount` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount paid', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101455')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrders (20230701101503)
  [1m[35m (43.8ms)[0m  [1m[35mCREATE TABLE `orders` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `account_id` int NOT NULL COMMENT 'related account id', `status` int NOT NULL COMMENT 'order status', `book_id` int NOT NULL COMMENT 'related book id', `amount` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount paid', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101503')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateBooks (20230701101507)
  [1m[35m (29.5ms)[0m  [1m[35mCREATE TABLE `books` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `name` varchar(255) DEFAULT '' NOT NULL COMMENT 'book name', `author` varchar(255) DEFAULT '' NOT NULL COMMENT 'book author', `inventory` int DEFAULT 0 NOT NULL COMMENT 'inventory', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (3.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101507')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateMonthlySummaries (20230701101547)
  [1m[35m (42.8ms)[0m  [1m[35mCREATE TABLE `monthly_summaries` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` int NOT NULL COMMENT 'related user id', `month` int NOT NULL COMMENT 'month', `amount_spent` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount spent', `number_of_borrow` int NOT NULL COMMENT 'user number of borrow on a month', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101547')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateAnnualSummaries (20230701101553)
  [1m[35m (56.2ms)[0m  [1m[35mCREATE TABLE `annual_summaries` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` int NOT NULL COMMENT 'related user id', `year` int NOT NULL COMMENT 'year', `amount_spent` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount spent', `number_of_borrow` int NOT NULL COMMENT 'user number of borrow on a year', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (2.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101553')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (10.8ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('5328620127835068540')[0m
  [1m[35m (9.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (10.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (8.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (7.8ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (4.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (10.8ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (7.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (18.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (3.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (6.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (9.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (13.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mUser Load (6.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` ORDER BY `users`.`id` DESC LIMIT 1[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (13.1ms)[0m  [1m[32mINSERT INTO `users` (`id`, `name`, `email`, `phone`, `created_at`, `updated_at`) VALUES (1, 'Bob', 'bob@gamil.com', 123, '2023-07-02 08:41:16.627301', '2023-07-02 08:41:16.627301')[0m
  [1m[36mTRANSACTION (5.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (3.2ms)[0m  [1m[32mINSERT INTO `users` (`id`, `name`, `email`, `phone`, `created_at`, `updated_at`) VALUES (2, 'Bill', 'bill@gamil.com', 123, '2023-07-02 08:41:16.670765', '2023-07-02 08:41:16.670765')[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mAccount Load (2.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (6.4ms)[0m  [1m[32mINSERT INTO `users` (`id`, `name`, `email`, `phone`, `created_at`, `updated_at`) VALUES (1, 'Bob', 'bob@gamil.com', 123, '2023-07-02 08:41:42.466651', '2023-07-02 08:41:42.466651')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (2.0ms)[0m  [1m[32mINSERT INTO `users` (`name`, `email`, `phone`, `created_at`, `updated_at`) VALUES ('Bob', 'bob@gamil.com', 123, '2023-07-02 08:42:02.269883', '2023-07-02 08:42:02.269883')[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (1.4ms)[0m  [1m[32mINSERT INTO `users` (`name`, `email`, `phone`, `created_at`, `updated_at`) VALUES ('Bill', 'bill@gamil.com', 123, '2023-07-02 08:42:02.275746', '2023-07-02 08:42:02.275746')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (13.1ms)[0m  [1m[34mSELECT `users`.* FROM `users`[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` ORDER BY `users`.`id` DESC LIMIT 1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Destroy (4.0ms)[0m  [1m[31mDELETE FROM `users` WHERE `users`.`id` = 4[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` ORDER BY `users`.`id` DESC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Destroy (1.9ms)[0m  [1m[31mDELETE FROM `users` WHERE `users`.`id` = 3[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT `users`.* FROM `users`[0m
  [1m[36mAccount Load (7.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBook Create (7.9ms)[0m  [1m[32mINSERT INTO `books` (`name`, `author`, `inventory`, `created_at`, `updated_at`) VALUES ('A Brief History of Time: from the Big Bang to Black Holes', 'Stephen William Hawking', 10, '2023-07-02 08:44:19.515108', '2023-07-02 08:44:19.515108')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBook Create (0.5ms)[0m  [1m[32mINSERT INTO `books` (`name`, `author`, `inventory`, `created_at`, `updated_at`) VALUES ('A Brief History of Time: from the Big Bang to Black Holes', 'Stephen William Hawking', 10, '2023-07-02 08:44:19.525633', '2023-07-02 08:44:19.525633')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` ORDER BY `books`.`id` DESC LIMIT 1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBook Update (7.8ms)[0m  [1m[33mUPDATE `books` SET `books`.`name` = 'Star Trek', `books`.`updated_at` = '2023-07-02 08:48:59.670644' WHERE `books`.`id` = 2[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBook Update (3.5ms)[0m  [1m[33mUPDATE `books` SET `books`.`author` = 'Robert Anson Heinlein', `books`.`updated_at` = '2023-07-02 08:49:24.193385' WHERE `books`.`id` = 2[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAccount Create (1.4ms)[0m  [1m[32mINSERT INTO `accounts` (`status`, `balance`, `user_id`, `created_at`, `updated_at`) VALUES (1, 36.0, 1, '2023-07-02 08:49:39.606801', '2023-07-02 08:49:39.606801')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAccount Create (1.4ms)[0m  [1m[32mINSERT INTO `accounts` (`status`, `balance`, `user_id`, `created_at`, `updated_at`) VALUES (1, 57.0, 2, '2023-07-02 08:49:39.611062', '2023-07-02 08:49:39.611062')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
Started POST "/api/v1/user/manage/set_user_amount?user_id%20=1" for ::1 at 2023-07-02 17:15:52 +0800
  [1m[35m (2.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  
ActionController::RoutingError (No route matches [POST] "/api/v1/user/manage/set_user_amount"):
  
Started POST "/api/v1/user/manage/set_user_amount?user_id%20=1" for ::1 at 2023-07-02 17:17:11 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 17:17:11 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id "=>"1"}
  NameError: uninitialized constant User (call 'User.connection' to establish a connection)::RccRole
Completed 500 in 11.39ms

  
NameError (uninitialized constant User (call 'User.connection' to establish a connection)::RccRole):
  
app/models/auth/user.rb:118:in `can?'
app/api/common_helpers/permission_helper.rb:25:in `authenticate_permission!'
app/api/application_api.rb:51:in `block in <class:ApplicationAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id%20=1" for ::1 at 2023-07-02 17:19:03 +0800
  [1m[35m (1.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 17:19:03 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id "=>"1"}
  Grape::Exceptions::ValidationErrors: user_id is missing, user_id is empty, amount is missing, amount is empty
Completed 500 in 515.85ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=1" for ::1 at 2023-07-02 17:19:12 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 17:19:12 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1"}
  Grape::Exceptions::ValidationErrors: amount is missing, amount is empty
Completed 500 in 1.08ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=1&amount=1" for ::1 at 2023-07-02 17:19:22 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 17:19:22 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "amount"=>"1"}
  NameError: uninitialized constant V1::User::SetUserAmountCommand
Completed 500 in 6.67ms

  
NameError (uninitialized constant V1::User::SetUserAmountCommand):
  
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&amount=1" for ::1 at 2023-07-02 17:19:48 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 17:19:48 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "amount"=>"1"}
  Zeitwerk::NameError: expected file /Users/cuisiming/daily_plan/rails-demo/app/commands/v1/user/manage/set_user_amount_command.rb to define constant V1::User::Manage::SetUserAmountCommand, but didn't
Completed 500 in 2.4ms

  
Zeitwerk::NameError (expected file /Users/cuisiming/daily_plan/rails-demo/app/commands/v1/user/manage/set_user_amount_command.rb to define constant V1::User::Manage::SetUserAmountCommand, but didn't):
  
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&amount=1" for ::1 at 2023-07-02 17:20:34 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 17:20:34 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "amount"=>"1"}
  NameError: undefined local variable or method `params' for #<V1::User::Manage::SetUserAmountCommand:0x00007ff0edd52ce0>
Completed 500 in 3.57ms

  
NameError (undefined local variable or method `params' for #<V1::User::Manage::SetUserAmountCommand:0x00007ff0edd52ce0>):
  
app/commands/v1/user/manage/set_user_amount_command.rb:23:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&amount=1" for ::1 at 2023-07-02 17:21:12 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 17:21:12 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "amount"=>"1"}
  NoMethodError: undefined method `find' for V1::User:Module
Completed 500 in 3.6ms

  
NoMethodError (undefined method `find' for V1::User:Module):
  
app/commands/v1/user/manage/set_user_amount_command.rb:23:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&amount=1" for ::1 at 2023-07-02 17:21:24 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 17:21:24 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "amount"=>"1"}
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:23:in `perform'
Completed 201 in 49.67ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:06:45 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:06:45 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (10.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  V1::User::Manage::SetUserAmountCommandError: 未查询到用户
Completed 500 in 104.73ms

  
V1::User::Manage::SetUserAmountCommandError (未查询到用户):
  
app/commands/v1/user/manage/set_user_amount_command.rb:26:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:07:53 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:07:53 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (12.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  NoMethodError: undefined method `to_sym' for {:message=>"缺少page参数"}:Hash
Did you mean?  to_s
               to_set
Completed 500 in 67.22ms

  
NoMethodError (undefined method `to_sym' for {:message=>"缺少page参数"}:Hash
Did you mean?  to_s
               to_set):
  
app/commands/v1/user/manage/set_user_amount_command.rb:26:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:12:58 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:12:58 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (4.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  NoMethodError: undefined method `user' for #<V1::User::Manage::SetUserAmountCommand:0x00007ff0eee280b0>
Did you mean?  user_id
Completed 500 in 76.43ms

  
NoMethodError (undefined method `user' for #<V1::User::Manage::SetUserAmountCommand:0x00007ff0eee280b0>
Did you mean?  user_id):
  
app/api/common_helpers/response_helper.rb:184:in `exec_render'
app/api/common_helpers/response_helper.rb:65:in `render_failed'
app/api/common_helpers/response_helper.rb:103:in `render_std'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:15:47 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:15:48 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (11.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
Completed 201 in 78.17ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:16:05 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:16:05 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (13.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
Completed 201 in 65.25ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:16:27 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:16:28 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (25.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
Completed 201 in 63.23ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:18:16 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:18:16 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (25.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  NoMethodError: undefined method `account' for nil:NilClass
Completed 500 in 76.8ms

  
NoMethodError (undefined method `account' for nil:NilClass):
  
app/commands/v1/user/manage/set_user_amount_command.rb:27:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:19:59 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:19:59 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (12.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  V1::User::Manage::SetUserAmountCommandError: 用户不存在
Completed 500 in 54.2ms

  
V1::User::Manage::SetUserAmountCommandError (用户不存在):
  
app/commands/v1/user/manage/set_user_amount_command.rb:27:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:20:08 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:20:08 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  V1::User::Manage::SetUserAmountCommandError: 用户不存在
Completed 500 in 50.72ms

  
V1::User::Manage::SetUserAmountCommandError (用户不存在):
  
app/commands/v1/user/manage/set_user_amount_command.rb:27:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:21:39 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:21:39 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  V1::User::Manage::SetUserAmountCommandError: 用户不存在
Completed 500 in 36.35ms

  
V1::User::Manage::SetUserAmountCommandError (用户不存在):
  
app/commands/v1/user/manage/set_user_amount_command.rb:27:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:22:39 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:22:39 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  V1::User::Manage::SetUserAmountCommandError: 用户不存在
Completed 500 in 36.59ms

  
V1::User::Manage::SetUserAmountCommandError (用户不存在):
  
app/commands/v1/user/manage/set_user_amount_command.rb:27:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:24:40 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:24:40 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (76.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  V1::User::Manage::SetUserAmountCommandError: 用户不存在
Completed 500 in 245.01ms

  
V1::User::Manage::SetUserAmountCommandError (用户不存在):
  
app/commands/v1/user/manage/set_user_amount_command.rb:27:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=12&amount=1" for ::1 at 2023-07-02 19:24:57 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:24:57 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"12", "amount"=>"1"}
  [1m[36mUser Load (4.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  V1::User::Manage::SetUserAmountCommandError: 用户不存在
Completed 500 in 449.82ms

  
V1::User::Manage::SetUserAmountCommandError (用户不存在):
  
app/commands/v1/user/manage/set_user_amount_command.rb:27:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&amount=100" for ::1 at 2023-07-02 19:28:39 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:28:39 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "amount"=>"100"}
  [1m[36mUser Load (10.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (7.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  ActiveModel::UnknownAttributeError: unknown attribute 'amount' for Account.
Completed 500 in 197.15ms

  
ActiveModel::UnknownAttributeError (unknown attribute 'amount' for Account.):
  
app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
app/api/v1/user/manage_api.rb:28:in `block (2 levels) in <module:ManageAPI>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&amount=100" for ::1 at 2023-07-02 19:29:13 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:29:13 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "amount"=>"100"}
  Grape::Exceptions::ValidationErrors: balance is missing, balance is empty
Completed 500 in 4.35ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=100" for ::1 at 2023-07-02 19:29:21 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 19:29:21 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "balance"=>"100"}
  [1m[36mUser Load (21.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (9.8ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mAccount Update (11.1ms)[0m  [1m[33mUPDATE `accounts` SET `accounts`.`balance` = 100.0, `accounts`.`updated_at` = '2023-07-02 11:29:21.311914' WHERE `accounts`.`id` = 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mTRANSACTION (6.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
Completed 201 in 180.65ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-02 20:45:52 +0800
  
ActionController::RoutingError (No route matches [POST] "/api/v1/borrow/create_borrow_book_order"):
  
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-02 20:48:22 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 20:48:22 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  NameError: uninitialized constant V1::User::Manage::BorrowBookCommand
Completed 500 in 66.63ms

  
NameError (uninitialized constant V1::User::Manage::BorrowBookCommand):
  
app/api/v1/borrow_api.rb:27:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-02 20:48:51 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 20:48:51 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (4.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:23:in `perform'
  [1m[36mAccount Load (4.7ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:26:in `perform'
  NameError: undefined local variable or method `balance' for #<V1::Borrow::BorrowBookCommand:0x00007ff0f301ce58>
Completed 500 in 197.64ms

  
NameError (undefined local variable or method `balance' for #<V1::Borrow::BorrowBookCommand:0x00007ff0f301ce58>):
  
app/commands/v1/borrow/borrow_book_command.rb:26:in `perform'
app/api/v1/borrow_api.rb:27:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-02 20:49:20 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 20:49:20 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:23:in `perform'
Completed 201 in 54.78ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=1" for ::1 at 2023-07-02 20:53:05 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 20:53:05 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (4.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:23:in `perform'
Completed 201 in 49.43ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=1" for ::1 at 2023-07-02 20:53:55 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 20:53:55 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (3.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:23:in `perform'
Completed 201 in 48.31ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=1" for ::1 at 2023-07-02 20:57:34 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 20:57:34 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:23:in `perform'
Completed 201 in 61.89ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=100" for ::1 at 2023-07-02 22:19:10 +0800
  
SyntaxError (/Users/cuisiming/daily_plan/rails-demo/app/api/v1/borrow_api.rb:27: syntax error, unexpected ':', expecting `end'
          borrowed_at: borrowed_at,
                     ^
):
  
app/api/v1/borrow_api.rb:27: syntax error, unexpected ':', expecting `end'
app/api/v1/borrow_api.rb:27: syntax error, unexpected ':', expecting `end'
app/api/v1/main.rb:17:in `<class:Main>'
app/api/v1/main.rb:9:in `<module:V1>'
app/api/v1/main.rb:3:in `<main>'
app/api/application_api.rb:55:in `<class:ApplicationAPI>'
app/api/application_api.rb:10:in `<main>'
config/routes.rb:11:in `block in <main>'
config/routes.rb:10:in `<main>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=100" for ::1 at 2023-07-02 22:20:46 +0800
  
ActiveRecord::ConnectionNotEstablished (No connection pool for 'ApplicationRecord' found.):
  
activerecord (6.1.7.4) lib/active_record/connection_adapters/abstract/connection_pool.rb:1125:in `retrieve_connection'
activerecord (6.1.7.4) lib/active_record/connection_handling.rb:327:in `retrieve_connection'
activerecord (6.1.7.4) lib/active_record/connection_handling.rb:283:in `connection'
activerecord (6.1.7.4) lib/active_record/model_schema.rb:380:in `table_exists?'
activerecord (6.1.7.4) lib/active_record/migration.rb:1108:in `get_all_versions'
activerecord (6.1.7.4) lib/active_record/migration.rb:1121:in `needs_migration?'
activerecord (6.1.7.4) lib/active_record/migration.rb:625:in `check_pending!'
activerecord (6.1.7.4) lib/active_record/migration.rb:590:in `block (2 levels) in call'
activesupport (6.1.7.4) lib/active_support/evented_file_update_checker.rb:59:in `execute'
activesupport (6.1.7.4) lib/active_support/evented_file_update_checker.rb:65:in `execute_if_updated'
activerecord (6.1.7.4) lib/active_record/migration.rb:597:in `block in call'
activerecord (6.1.7.4) lib/active_record/migration.rb:587:in `synchronize'
activerecord (6.1.7.4) lib/active_record/migration.rb:587:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (6.1.7.4) lib/active_support/callbacks.rb:98:in `run_callbacks'
actionpack (6.1.7.4) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/debug_exceptions.rb:29:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/show_exceptions.rb:33:in `call'
railties (6.1.7.4) lib/rails/rack/logger.rb:37:in `call_app'
railties (6.1.7.4) lib/rails/rack/logger.rb:26:in `block in call'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (6.1.7.4) lib/rails/rack/logger.rb:26:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/remote_ip.rb:81:in `call'
request_store (1.5.1) lib/request_store/middleware.rb:19:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.7) lib/rack/runtime.rb:22:in `call'
activesupport (6.1.7.4) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/static.rb:24:in `call'
rack (2.2.7) lib/rack/sendfile.rb:110:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/host_authorization.rb:148:in `call'
railties (6.1.7.4) lib/rails/engine.rb:539:in `call'
puma (5.6.6) lib/puma/configuration.rb:252:in `call'
puma (5.6.6) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.6) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.6) lib/puma/request.rb:76:in `handle_request'
puma (5.6.6) lib/puma/server.rb:443:in `process_client'
puma (5.6.6) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` ORDER BY `users`.`id` DESC LIMIT 1[0m
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=100" for ::1 at 2023-07-02 22:21:09 +0800
  [1m[35m (23.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-02 22:21:09 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "balance"=>"100"}
  [1m[36mUser Load (2.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (12.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
Completed 201 in 130.14ms

  [1m[35m (6.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (2.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (2.6ms)[0m  [1m[34mSELECT GET_LOCK('5328620127835068540', 0)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateAnnualSummaries (20230701101553)
  [1m[35m (221.2ms)[0m  [1m[35mDROP TABLE `annual_summaries`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (4.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101553'[0m
Migrating to CreateMonthlySummaries (20230701101547)
  [1m[35m (55.6ms)[0m  [1m[35mDROP TABLE `monthly_summaries`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (2.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101547'[0m
Migrating to CreateBooks (20230701101507)
  [1m[35m (50.9ms)[0m  [1m[35mDROP TABLE `books`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (2.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101507'[0m
Migrating to CreateOrders (20230701101503)
  [1m[35m (35.0ms)[0m  [1m[35mDROP TABLE `orders`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (2.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101503'[0m
Migrating to CreatePayments (20230701101455)
  [1m[35m (26.5ms)[0m  [1m[35mDROP TABLE `payments`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (1.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101455'[0m
Migrating to CreateUsers (20230701101004)
  [1m[35m (40.6ms)[0m  [1m[35mDROP TABLE `users`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (3.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101004'[0m
Migrating to CreateAccounts (20230701100959)
  [1m[35m (36.4ms)[0m  [1m[35mDROP TABLE `accounts`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (2.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701100959'[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('5328620127835068540')[0m
  [1m[35m (5.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT GET_LOCK('5328620127835068540', 0)[0m
  [1m[35m (20.8ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateAccounts (20230701100959)
  [1m[35m (63.0ms)[0m  [1m[35mCREATE TABLE `accounts` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `status` int DEFAULT 0 NOT NULL COMMENT 'account status', `balance` float(24) DEFAULT 0.0 NOT NULL COMMENT 'balance', `user_id` int DEFAULT 0 NOT NULL COMMENT 'related user id', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701100959')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateUsers (20230701101004)
  [1m[35m (26.4ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `name` varchar(255) DEFAULT '' NOT NULL COMMENT 'user name', `email` varchar(255) DEFAULT '' NOT NULL COMMENT 'email', `phone` int DEFAULT 0 NOT NULL COMMENT 'phone', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101004')[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePayments (20230701101455)
  [1m[35m (23.1ms)[0m  [1m[35mCREATE TABLE `payments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `order_id` int NOT NULL COMMENT 'related order id', `status` int DEFAULT 0 NOT NULL COMMENT 'payment status', `paid_amount` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount paid', `paid_time` datetime COMMENT 'Books actually return to time', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101455')[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrders (20230701101503)
  [1m[35m (184.9ms)[0m  [1m[35mCREATE TABLE `orders` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `account_id` int NOT NULL COMMENT 'related account id', `status` int NOT NULL COMMENT 'order status', `book_id` int NOT NULL COMMENT 'related book id', `borrowed_at` datetime COMMENT 'books borrowed time', `estimated_return_time` datetime COMMENT 'books estimated time of return', `actual_return_time` datetime COMMENT 'Books actually return to time', `amount` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount paid', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (10.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101503')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateBooks (20230701101507)
  [1m[35m (64.1ms)[0m  [1m[35mCREATE TABLE `books` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `name` varchar(255) DEFAULT '' NOT NULL COMMENT 'book name', `author` varchar(255) DEFAULT '' NOT NULL COMMENT 'book author', `inventory` int DEFAULT 0 NOT NULL COMMENT 'inventory', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101507')[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateMonthlySummaries (20230701101547)
  [1m[35m (39.3ms)[0m  [1m[35mCREATE TABLE `monthly_summaries` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` int NOT NULL COMMENT 'related user id', `month` int NOT NULL COMMENT 'month', `amount_spent` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount spent', `number_of_borrow` int NOT NULL COMMENT 'user number of borrow on a month', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101547')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateAnnualSummaries (20230701101553)
  [1m[35m (36.0ms)[0m  [1m[35mCREATE TABLE `annual_summaries` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` int NOT NULL COMMENT 'related user id', `year` int NOT NULL COMMENT 'year', `amount_spent` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount spent', `number_of_borrow` int NOT NULL COMMENT 'user number of borrow on a year', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101553')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT RELEASE_LOCK('5328620127835068540')[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (1.2ms)[0m  [1m[32mINSERT INTO `users` (`name`, `email`, `phone`, `created_at`, `updated_at`) VALUES ('Bob', 'bob@gamil.com', 123, '2023-07-02 14:25:13.487908', '2023-07-02 14:25:13.487908')[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (1.3ms)[0m  [1m[32mINSERT INTO `users` (`name`, `email`, `phone`, `created_at`, `updated_at`) VALUES ('Bill', 'bill@gamil.com', 123, '2023-07-02 14:25:13.506022', '2023-07-02 14:25:13.506022')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAccount Create (7.9ms)[0m  [1m[32mINSERT INTO `accounts` (`status`, `balance`, `user_id`, `created_at`, `updated_at`) VALUES (1, 64.0, 1, '2023-07-02 14:25:13.523821', '2023-07-02 14:25:13.523821')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAccount Create (0.3ms)[0m  [1m[32mINSERT INTO `accounts` (`status`, `balance`, `user_id`, `created_at`, `updated_at`) VALUES (1, 35.0, 2, '2023-07-02 14:25:13.537088', '2023-07-02 14:25:13.537088')[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBook Create (18.1ms)[0m  [1m[32mINSERT INTO `books` (`name`, `author`, `inventory`, `created_at`, `updated_at`) VALUES ('A Brief History of Time: from the Big Bang to Black Holes', 'Stephen William Hawking', 10, '2023-07-02 14:25:13.551539', '2023-07-02 14:25:13.551539')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBook Create (0.4ms)[0m  [1m[32mINSERT INTO `books` (`name`, `author`, `inventory`, `created_at`, `updated_at`) VALUES ('A Brief History of Time: from the Big Bang to Black Holes', 'Stephen William Hawking', 10, '2023-07-02 14:25:13.573434', '2023-07-02 14:25:13.573434')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-02 22:25:28 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 22:25:28 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:39:in `data_check'
  [1m[36mAccount Load (9.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  NameError: undefined local variable or method `account' for #<V1::Borrow::BorrowBookCommand:0x00007ff0f501ccf8>
Completed 500 in 103.26ms

  
NameError (undefined local variable or method `account' for #<V1::Borrow::BorrowBookCommand:0x00007ff0f501ccf8>):
  
app/commands/v1/borrow/borrow_book_command.rb:43:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:28:in `perform'
app/api/v1/borrow_api.rb:29:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-02 22:26:08 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 22:26:08 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:39:in `data_check'
  [1m[36mAccount Load (6.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  NameError: undefined local variable or method `account' for #<V1::Borrow::BorrowBookCommand:0x00007ff0edc0f248>
Completed 500 in 41966.83ms

  
NameError (undefined local variable or method `account' for #<V1::Borrow::BorrowBookCommand:0x00007ff0edc0f248>):
  
app/commands/v1/borrow/borrow_book_command.rb:43:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:28:in `perform'
app/api/v1/borrow_api.rb:29:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-02 22:26:56 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 22:26:56 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:38:in `data_check'
  [1m[36mAccount Load (1.1ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:40:in `data_check'
  NameError: uninitialized constant V1::User::Borrow
Did you mean?  V1::Borrow
Completed 500 in 60.05ms

  
NameError (uninitialized constant V1::User::Borrow
Did you mean?  V1::Borrow):
  
app/commands/v1/borrow/borrow_book_command.rb:61:in `block in create_borrow_book_related_data'
app/commands/v1/borrow/borrow_book_command.rb:53:in `create_borrow_book_related_data'
app/commands/v1/borrow/borrow_book_command.rb:29:in `perform'
app/api/v1/borrow_api.rb:29:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-02 22:27:11 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 22:27:11 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:38:in `data_check'
  [1m[36mAccount Load (8.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:40:in `data_check'
  TypeError: no implicit conversion of nil into String
Completed 500 in 65.51ms

  
TypeError (no implicit conversion of nil into String):
  
app/commands/v1/borrow/borrow_book_command.rb:61:in `parse'
app/commands/v1/borrow/borrow_book_command.rb:61:in `block in create_borrow_book_related_data'
app/commands/v1/borrow/borrow_book_command.rb:53:in `create_borrow_book_related_data'
app/commands/v1/borrow/borrow_book_command.rb:29:in `perform'
app/api/v1/borrow_api.rb:29:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-02 22:29:09 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 22:29:09 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:38:in `data_check'
  [1m[36mAccount Load (2.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:40:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:59:in `block in create_borrow_book_related_data'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:59:in `block in create_borrow_book_related_data'
  [1m[36mOrder Create (4.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `created_at`, `updated_at`) VALUES (1, 0, '2023-07-02 14:29:09.374730', '2023-07-02 14:29:09.374730')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:59:in `block in create_borrow_book_related_data'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:53:in `create_borrow_book_related_data'
  ActiveRecord::NotNullViolation: Mysql2::Error: Field 'book_id' doesn't have a default value
Completed 500 in 94.18ms

  
ActiveRecord::NotNullViolation (Mysql2::Error: Field 'book_id' doesn't have a default value):
  
app/commands/v1/borrow/borrow_book_command.rb:59:in `block in create_borrow_book_related_data'
app/commands/v1/borrow/borrow_book_command.rb:53:in `create_borrow_book_related_data'
app/commands/v1/borrow/borrow_book_command.rb:29:in `perform'
app/api/v1/borrow_api.rb:29:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-02 22:30:05 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-02 22:30:06 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (30.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:38:in `data_check'
  [1m[36mBook Load (1.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:40:in `data_check'
  [1m[36mAccount Load (1.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:42:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:61:in `block in create_borrow_book_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:61:in `block in create_borrow_book_related_data'
  [1m[36mOrder Create (3.1ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-02 14:30:06.212413', '2023-07-02 14:30:06.212413')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:61:in `block in create_borrow_book_related_data'
  [1m[36mOrder Load (0.5ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:70:in `block in create_borrow_book_related_data'
  [1m[36mPayment Create (0.5ms)[0m  [1m[32mINSERT INTO `payments` (`order_id`, `created_at`, `updated_at`) VALUES (1, '2023-07-02 14:30:06.250955', '2023-07-02 14:30:06.250955')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:70:in `block in create_borrow_book_related_data'
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:55:in `create_borrow_book_related_data'
Completed 201 in 200.41ms

  [1m[36mOrder Load (5.7ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` ORDER BY `orders`.`id` DESC LIMIT 1[0m
Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-02 23:32:55 +0800

Started POST "/api/v1/return/return_book" at 2023-07-02 23:32:56 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (3.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `data_check'
  [1m[36mBook Load (21.9ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:45:in `data_check'
  [1m[36mAccount Load (14.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:47:in `data_check'
  NoMethodError: undefined method `blnak?' for #<Account:0x00007ff0f3294780>
Did you mean?  blank?
Completed 500 in 282.62ms

  
NoMethodError (undefined method `blnak?' for #<Account:0x00007ff0f3294780>
Did you mean?  blank?):
  
app/commands/v1/return/return_book_command.rb:48:in `data_check'
app/commands/v1/return/return_book_command.rb:23:in `perform'
app/api/v1/return_api.rb:27:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-02 23:33:18 +0800

Started POST "/api/v1/return/return_book" at 2023-07-02 23:33:18 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `data_check'
  [1m[36mBook Load (2.9ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:45:in `data_check'
  [1m[36mAccount Load (1.7ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:47:in `data_check'
  [1m[36mOrder Load (13.2ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:24:in `perform'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mOrder Update (6.5ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`status` = 1, `orders`.`estimated_return_time` = '2023-07-02 15:33:18', `orders`.`updated_at` = '2023-07-02 15:33:18.428028' WHERE `orders`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mPayment Update All (11.6ms)[0m  [1m[33mUPDATE `payments` SET `payments`.`amount` = 0, `payments`.`status` = 1 WHERE `payments`.`order_id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:63:in `deal_payments'
  ActiveRecord::StatementInvalid: Mysql2::Error: Unknown column 'payments.amount' in 'field list'
Completed 500 in 225.04ms

  
ActiveRecord::StatementInvalid (Mysql2::Error: Unknown column 'payments.amount' in 'field list'):
  
app/commands/v1/return/return_book_command.rb:63:in `deal_payments'
app/commands/v1/return/return_book_command.rb:33:in `perform'
app/api/v1/return_api.rb:27:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-02 23:34:04 +0800

Started POST "/api/v1/return/return_book" at 2023-07-02 23:34:04 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `data_check'
  [1m[36mBook Load (1.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:45:in `data_check'
  [1m[36mAccount Load (0.7ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:47:in `data_check'
  [1m[36mOrder Load (3.0ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:24:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mAccount Load (13.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mOrder Update (4.0ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`estimated_return_time` = '2023-07-02 15:34:04', `orders`.`updated_at` = '2023-07-02 15:34:04.937256' WHERE `orders`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (4.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mPayment Update All (3.8ms)[0m  [1m[33mUPDATE `payments` SET `payments`.`paid_amount` = 0.0, `payments`.`status` = 1 WHERE `payments`.`order_id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:63:in `deal_payments'
Completed 201 in 173.88ms

  [1m[36mOrder Load (2.4ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` ORDER BY `orders`.`id` DESC LIMIT 1[0m
Started GET "/api/v1/user/info/search?user_id=1" for ::1 at 2023-07-03 00:38:31 +0800

Started GET "/api/v1/user/info/search" at 2023-07-03 00:38:31 +0800
Processing by V1::UserAPI/user/info/search
  Parameters: {"user_id"=>"1"}
  [1m[36mUser Load (5.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:24:in `perform'
  [1m[36mAccount Load (6.8ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:27:in `perform'
  NameError: undefined local variable or method `balance' for #<V1::User::Info::SearchCommand:0x00007ff0ead8d3e8>
Completed 500 in 204.7ms

  
NameError (undefined local variable or method `balance' for #<V1::User::Info::SearchCommand:0x00007ff0ead8d3e8>):
  
app/commands/v1/user/info/search_command.rb:27:in `perform'
app/api/v1/user/info_api.rb:27:in `block (2 levels) in <module:InfoAPI>'
Started GET "/api/v1/user/info/search?user_id=1" for ::1 at 2023-07-03 00:40:49 +0800
  
NameError (uninitialized constant V1::Entities::Account::Info
Did you mean?  TZInfo):
  
app/api/v1/entities/user/user_info.rb:14:in `<class:UserInfo>'
app/api/v1/entities/user/user_info.rb:12:in `<module:User>'
app/api/v1/entities/user/user_info.rb:5:in `<module:Entities>'
app/api/v1/entities/user/user_info.rb:4:in `<module:V1>'
app/api/v1/entities/user/user_info.rb:3:in `<main>'
app/api/v1/user/info_api.rb:22:in `block in <module:InfoAPI>'
app/api/v1/user_api.rb:15:in `include'
app/api/v1/user_api.rb:15:in `block (2 levels) in <class:UserAPI>'
app/api/v1/user_api.rb:14:in `block in <class:UserAPI>'
app/api/v1/user_api.rb:9:in `<class:UserAPI>'
app/api/v1/user_api.rb:8:in `<module:V1>'
app/api/v1/user_api.rb:3:in `<main>'
app/api/v1/main.rb:16:in `<class:Main>'
app/api/v1/main.rb:9:in `<module:V1>'
app/api/v1/main.rb:3:in `<main>'
app/api/application_api.rb:55:in `<class:ApplicationAPI>'
app/api/application_api.rb:10:in `<main>'
config/routes.rb:11:in `block in <main>'
config/routes.rb:10:in `<main>'
Started GET "/api/v1/user/info/search?user_id=1" for ::1 at 2023-07-03 00:41:37 +0800

Started GET "/api/v1/user/info/search" at 2023-07-03 00:41:37 +0800
Processing by V1::UserAPI/user/info/search
  Parameters: {"user_id"=>"1"}
  [1m[36mUser Load (15.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:24:in `perform'
  [1m[36mAccount Load (5.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:28:in `perform'
Completed 200 in 159.19ms

  
NoMethodError (V1::Entities::User::Info missing attribute `username' on #<User:0x00007ff0edcf36c8>):
  
app/api/response_info.rb:42:in `to_json'
Started GET "/api/v1/user/info/search?user_id=1" for ::1 at 2023-07-03 00:42:01 +0800

Started GET "/api/v1/user/info/search" at 2023-07-03 00:42:01 +0800
Processing by V1::UserAPI/user/info/search
  Parameters: {"user_id"=>"1"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:24:in `perform'
  [1m[36mAccount Load (4.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:28:in `perform'
Completed 200 in 123.88ms

  [1m[36mOrder Load (3.0ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`account_id` = 1[0m
  ↳ app/api/response_info.rb:42:in `to_json'
[ActionDispatch::HostAuthorization::DefaultResponseApp] Blocked host: local.git.com
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-03 22:30:52 +0800
  [1m[35m (19.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-03 22:30:53 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (19.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:38:in `data_check'
  NameError: undefined local variable or method `user' for #<V1::Borrow::BorrowBookCommand:0x00007fbff6e747e0>
Did you mean?  @user
Completed 500 in 234.48ms

  
NameError (undefined local variable or method `user' for #<V1::Borrow::BorrowBookCommand:0x00007fbff6e747e0>
Did you mean?  @user):
  
app/commands/v1/borrow/borrow_book_command.rb:39:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:28:in `perform'
app/api/v1/borrow_api.rb:29:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-03 22:31:22 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-03 22:31:22 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (5.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:38:in `data_check'
  NoMethodError: undefined method `find_by_id' for V1::Book:Module
Completed 500 in 86.99ms

  
NoMethodError (undefined method `find_by_id' for V1::Book:Module):
  
app/commands/v1/borrow/borrow_book_command.rb:40:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:28:in `perform'
app/api/v1/borrow_api.rb:29:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-03 22:31:38 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-03 22:31:38 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (5.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:38:in `data_check'
  [1m[36mBook Load (26.1ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:40:in `data_check'
  [1m[36mAccount Load (5.7ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:42:in `data_check'
  ArgumentError: wrong number of arguments (given 1, expected 0)
Completed 500 in 211.38ms

  
ArgumentError (wrong number of arguments (given 1, expected 0)):
  
app/commands/v1/borrow/borrow_book_command.rb:54:in `create_borrow_book_related_data'
app/commands/v1/borrow/borrow_book_command.rb:29:in `perform'
app/api/v1/borrow_api.rb:29:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-03 22:31:51 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-03 22:31:52 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (3.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:38:in `data_check'
  [1m[36mBook Load (10.9ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:40:in `data_check'
  [1m[36mAccount Load (3.8ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:42:in `data_check'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `block in create_borrow_book_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `block in create_borrow_book_related_data'
  [1m[36mOrder Create (32.1ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-03 14:31:52', '2023-07-03 14:31:52.261589', '2023-07-03 14:31:52.261589')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `block in create_borrow_book_related_data'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:69:in `block in create_borrow_book_related_data'
  [1m[36mPayment Create (16.3ms)[0m  [1m[32mINSERT INTO `payments` (`order_id`, `created_at`, `updated_at`) VALUES (2, '2023-07-03 14:31:52.327327', '2023-07-03 14:31:52.327327')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:69:in `block in create_borrow_book_related_data'
  [1m[36mBook Update (5.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 9, `books`.`updated_at` = '2023-07-03 14:31:52.344954' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:74:in `block in create_borrow_book_related_data'
  [1m[36mTRANSACTION (6.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:54:in `create_borrow_book_related_data'
Completed 201 in 442.42ms

Started GET "/api/v1/book/search_book_detail?book_id=1" for ::1 at 2023-07-03 22:57:03 +0800
  
ActionController::RoutingError (No route matches [GET] "/api/v1/book/search_book_detail"):
  
Started GET "/api/v1/book/search_book_detail?book_id=1" for ::1 at 2023-07-03 22:57:35 +0800

Started GET "/api/v1/book/search_book_detail" at 2023-07-03 22:57:35 +0800
Processing by V1::BookAPI/book/search_book_detail
  Parameters: {"book_id"=>"1"}
  NoMethodError: undefined method `find_by_id' for V1::Book:Module
Completed 500 in 18.04ms

  
NoMethodError (undefined method `find_by_id' for V1::Book:Module):
  
app/commands/v1/book/search_command.rb:24:in `perform'
app/api/v1/book_api.rb:27:in `block (2 levels) in <class:BookAPI>'
Started GET "/api/v1/book/search_book_detail?book_id=1" for ::1 at 2023-07-03 22:57:49 +0800

Started GET "/api/v1/book/search_book_detail" at 2023-07-03 22:57:49 +0800
Processing by V1::BookAPI/book/search_book_detail
  Parameters: {"book_id"=>"1"}
  [1m[36mBook Load (11.9ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:24:in `perform'
  [1m[36mOrder Load (12.3ms)[0m  [1m[34mSELECT `orders`.`id` FROM `orders` WHERE `orders`.`book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:45:in `compute_orders_amount'
  [1m[35m (21.1ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:46:in `block in compute_orders_amount'
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 2[0m
  ↳ app/commands/v1/book/search_command.rb:46:in `block in compute_orders_amount'
Completed 200 in 383.95ms

Started GET "/api/v1/book/search_book_detail?book_id=1" for ::1 at 2023-07-03 22:58:19 +0800

Started GET "/api/v1/book/search_book_detail" at 2023-07-03 22:58:19 +0800
Processing by V1::BookAPI/book/search_book_detail
  Parameters: {"book_id"=>"1"}
  [1m[36mBook Load (0.6ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:24:in `perform'
  [1m[36mOrder Load (0.5ms)[0m  [1m[34mSELECT `orders`.`id` FROM `orders` WHERE `orders`.`book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:45:in `compute_orders_amount'
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:46:in `block in compute_orders_amount'
  [1m[35m (1.3ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 2[0m
  ↳ app/commands/v1/book/search_command.rb:46:in `block in compute_orders_amount'
Completed 200 in 11.68ms

  [1m[36mOrder Load (16.3ms)[0m  [1m[34mSELECT `orders`.* FROM `orders`[0m
  [1m[35m (25.9ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 2[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 1[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 2[0m
  [1m[36mPayment Load (0.6ms)[0m  [1m[34mSELECT `payments`.* FROM `payments` WHERE `payments`.`order_id` = 1[0m
  [1m[35m (4.2ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 1[0m
  [1m[35m (40.6ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 1[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 2[0m
Started GET "/api/v1/book/search_book_detail?book_id=1" for ::1 at 2023-07-03 23:00:12 +0800

Started GET "/api/v1/book/search_book_detail" at 2023-07-03 23:00:12 +0800
Processing by V1::BookAPI/book/search_book_detail
  Parameters: {"book_id"=>"1"}
  [1m[36mBook Load (15.5ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:24:in `perform'
  [1m[36mOrder Load (8.4ms)[0m  [1m[34mSELECT `orders`.`id` FROM `orders` WHERE `orders`.`book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:45:in `compute_orders_amount'
  [1m[35m (10.1ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:46:in `block in compute_orders_amount'
  [1m[35m (1.2ms)[0m  [1m[34mSELECT SUM(`payments`.`paid_amount`) FROM `payments` WHERE `payments`.`order_id` = 2[0m
  ↳ app/commands/v1/book/search_command.rb:46:in `block in compute_orders_amount'
Completed 200 in 185.21ms

DEPRECATION WARNING: Initialization autoloaded the constants ApplicationJob and ExampleJob.

Being able to do this is deprecated. Autoloading during initialization is going
to be an error condition in future versions of Rails.

Reloading does not reboot the application, and therefore code executed during
initialization does not run again. So, if you reload ApplicationJob, for example,
the expected changes won't be reflected in that stale Class object.

These autoloaded constants have been unloaded.

In order to autoload safely at boot time, please wrap your code in a reloader
callback this way:

    Rails.application.reloader.to_prepare do
      # Autoload classes and modules needed at boot time here.
    end

That block runs when the application boots, and every time there is a reload.
For historical reasons, it may run twice, so it has to be idempotent.

Check the "Autoloading and Reloading Constants" guide to learn more about how
Rails autoloads and reloads.
 (called from <top (required)> at /Users/cuisiming/daily_plan/rails-demo/config/environment.rb:7)
DEPRECATION WARNING: Initialization autoloaded the constants ApplicationJob and ExampleJob.

Being able to do this is deprecated. Autoloading during initialization is going
to be an error condition in future versions of Rails.

Reloading does not reboot the application, and therefore code executed during
initialization does not run again. So, if you reload ApplicationJob, for example,
the expected changes won't be reflected in that stale Class object.

These autoloaded constants have been unloaded.

In order to autoload safely at boot time, please wrap your code in a reloader
callback this way:

    Rails.application.reloader.to_prepare do
      # Autoload classes and modules needed at boot time here.
    end

That block runs when the application boots, and every time there is a reload.
For historical reasons, it may run twice, so it has to be idempotent.

Check the "Autoloading and Reloading Constants" guide to learn more about how
Rails autoloads and reloads.
 (called from <top (required)> at /Users/cuisiming/daily_plan/rails-demo/config/environment.rb:7)
DEPRECATION WARNING: Initialization autoloaded the constants ApplicationJob, ExampleJob, MonthlySummaryJob, and AnnualSummaryJob.

Being able to do this is deprecated. Autoloading during initialization is going
to be an error condition in future versions of Rails.

Reloading does not reboot the application, and therefore code executed during
initialization does not run again. So, if you reload ApplicationJob, for example,
the expected changes won't be reflected in that stale Class object.

These autoloaded constants have been unloaded.

In order to autoload safely at boot time, please wrap your code in a reloader
callback this way:

    Rails.application.reloader.to_prepare do
      # Autoload classes and modules needed at boot time here.
    end

That block runs when the application boots, and every time there is a reload.
For historical reasons, it may run twice, so it has to be idempotent.

Check the "Autoloading and Reloading Constants" guide to learn more about how
Rails autoloads and reloads.
 (called from <top (required)> at /Users/cuisiming/daily_plan/rails-demo/config/environment.rb:7)
Started GET "/" for 127.0.0.1 at 2023-07-05 00:51:49 +0800
  [1m[35m (23.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by Rails::WelcomeController#index as HTML
  Rendering /Users/cuisiming/.rvm/gems/ruby-2.7.3/gems/railties-6.1.7.4/lib/rails/templates/rails/welcome/index.html.erb
  Rendered /Users/cuisiming/.rvm/gems/ruby-2.7.3/gems/railties-6.1.7.4/lib/rails/templates/rails/welcome/index.html.erb (Duration: 6.6ms | Allocations: 346)
Completed 200 OK in 16ms (Views: 10.3ms | ActiveRecord: 0.0ms | Allocations: 2755)


Started GET "/api/v1/swagger_doc" for ::1 at 2023-07-05 00:52:44 +0800

Started GET "/api/v1/swagger_doc" at 2023-07-05 00:52:44 +0800
Processing by #<Class:0x00007fdd20067a98>/swagger_doc
  Parameters: {}
Completed 200 in 11.18ms

Started POST "/api/v1/user/manage/set_user_amount" for ::1 at 2023-07-05 22:42:32 +0800
  [1m[35m (7.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35mCACHE  (0.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  
ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

        bin/rails db:migrate RAILS_ENV=development

You have 2 pending migrations:

20230705042635_create_hot_books.rb
20230705042819_create_daily_profits.rb


):
  
activerecord (6.1.7.4) lib/active_record/migration.rb:625:in `check_pending!'
activerecord (6.1.7.4) lib/active_record/migration.rb:590:in `block (2 levels) in call'
activesupport (6.1.7.4) lib/active_support/evented_file_update_checker.rb:59:in `execute'
activerecord (6.1.7.4) lib/active_record/migration.rb:595:in `block in call'
activerecord (6.1.7.4) lib/active_record/migration.rb:587:in `synchronize'
activerecord (6.1.7.4) lib/active_record/migration.rb:587:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (6.1.7.4) lib/active_support/callbacks.rb:98:in `run_callbacks'
actionpack (6.1.7.4) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/debug_exceptions.rb:29:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/show_exceptions.rb:33:in `call'
railties (6.1.7.4) lib/rails/rack/logger.rb:37:in `call_app'
railties (6.1.7.4) lib/rails/rack/logger.rb:26:in `block in call'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (6.1.7.4) lib/rails/rack/logger.rb:26:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/remote_ip.rb:81:in `call'
request_store (1.5.1) lib/request_store/middleware.rb:19:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.7) lib/rack/runtime.rb:22:in `call'
activesupport (6.1.7.4) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/static.rb:24:in `call'
rack (2.2.7) lib/rack/sendfile.rb:110:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/host_authorization.rb:148:in `call'
railties (6.1.7.4) lib/rails/engine.rb:539:in `call'
puma (5.6.6) lib/puma/configuration.rb:252:in `call'
puma (5.6.6) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.6) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.6) lib/puma/request.rb:76:in `handle_request'
puma (5.6.6) lib/puma/server.rb:443:in `process_client'
puma (5.6.6) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
  [1m[35m (3.4ms)[0m  [1m[34mSELECT GET_LOCK('5328620127835068540', 0)[0m
  [1m[35m (9.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateHotBooks (20230705042635)
  [1m[35m (260.8ms)[0m  [1m[35mCREATE TABLE `hot_books` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `name` varchar(255) DEFAULT '' NOT NULL COMMENT 'book name', `author` varchar(255) DEFAULT '' NOT NULL COMMENT 'book author', `inventory` int DEFAULT 0 NOT NULL COMMENT 'inventory', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (3.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230705042635')[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateDailyProfits (20230705042819)
  [1m[35m (53.6ms)[0m  [1m[35mCREATE TABLE `daily_profits` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `book_id` int NOT NULL COMMENT 'related book id', `borrowed_day` datetime COMMENT 'books borrowed date', `amount` float(24) DEFAULT 0.0 NOT NULL COMMENT 'book profit amount', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230705042819')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (8.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (2.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('5328620127835068540')[0m
  [1m[35m (4.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (7.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Started POST "/api/v1/user/manage/set_user_amount" for ::1 at 2023-07-05 22:46:42 +0800
  [1m[35m (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-05 22:46:42 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {}
  Grape::Exceptions::ValidationErrors: user_id is missing, user_id is empty, balance is missing, balance is empty
Completed 500 in 320.84ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=10" for ::1 at 2023-07-05 22:47:02 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-05 22:47:02 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "balance"=>"10"}
  [1m[36mUser Load (8.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (6.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mAccount Update (1.4ms)[0m  [1m[33mUPDATE `accounts` SET `accounts`.`balance` = 10.0, `accounts`.`updated_at` = '2023-07-05 14:47:02.941622' WHERE `accounts`.`id` = 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mTRANSACTION (6.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
Completed 201 in 124.47ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=10" for ::1 at 2023-07-05 22:47:34 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-05 22:47:35 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "balance"=>"10"}
  [1m[36mUser Load (35.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (17.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
Completed 201 in 564.82ms

  
NoMethodError (V1::Entities::User::UserInfo missing attribute `user_info' on #<User:0x00007f95e1c7d890>):
  
app/api/response_info.rb:42:in `to_json'
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=10" for ::1 at 2023-07-05 22:50:16 +0800
  
NameError (uninitialized constant V1::Entities::User::UserDetailInfo
Did you mean?  V1::Entities::User::UserInfo):
  
app/api/v1/user/info_api.rb:22:in `block in <module:InfoAPI>'
app/api/v1/user_api.rb:15:in `include'
app/api/v1/user_api.rb:15:in `block (2 levels) in <class:UserAPI>'
app/api/v1/user_api.rb:14:in `block in <class:UserAPI>'
app/api/v1/user_api.rb:9:in `<class:UserAPI>'
app/api/v1/user_api.rb:8:in `<module:V1>'
app/api/v1/user_api.rb:3:in `<top (required)>'
app/api/v1/main.rb:16:in `<class:Main>'
app/api/v1/main.rb:9:in `<module:V1>'
app/api/v1/main.rb:3:in `<top (required)>'
app/api/application_api.rb:58:in `<class:ApplicationAPI>'
app/api/application_api.rb:10:in `<top (required)>'
config/routes.rb:11:in `block in <top (required)>'
config/routes.rb:10:in `<top (required)>'
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=10" for ::1 at 2023-07-05 22:50:47 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-05 22:50:48 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "balance"=>"10"}
  [1m[36mUser Load (6.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (2.9ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
Completed 201 in 89.97ms

Started GET "/api/v1/user/info/search?user_id=1" for ::1 at 2023-07-05 23:06:43 +0800

Started GET "/api/v1/user/info/search" at 2023-07-05 23:06:43 +0800
Processing by V1::UserAPI/user/info/search
  Parameters: {"user_id"=>"1"}
  [1m[36mUser Load (7.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:24:in `perform'
  [1m[36mAccount Load (3.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:25:in `perform'
Completed 200 in 204.77ms

  [1m[36mOrder Load (7.2ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`account_id` = 1[0m
  ↳ app/api/response_info.rb:42:in `to_json'
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=10" for ::1 at 2023-07-05 23:09:14 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-05 23:09:14 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "balance"=>"10"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (12.1ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
Completed 201 in 28.52ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-05 23:10:32 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-05 23:10:32 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:37:in `data_check'
  [1m[36mBook Load (164.8ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:40:in `data_check'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:45:in `data_check'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:67:in `block in create_related_data'
  [1m[36mAccount Load (22.9ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:67:in `block in create_related_data'
  [1m[36mOrder Create (57.2ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-05 15:10:32', '2023-07-05 15:10:32.662276', '2023-07-05 15:10:32.662276')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:67:in `block in create_related_data'
  [1m[36mOrder Load (10.5ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`id` = 3 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:76:in `block in create_related_data'
  [1m[36mPayment Create (36.8ms)[0m  [1m[32mINSERT INTO `payments` (`order_id`, `created_at`, `updated_at`) VALUES (3, '2023-07-05 15:10:32.776786', '2023-07-05 15:10:32.776786')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:76:in `block in create_related_data'
  [1m[36mBook Update (9.6ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 8, `books`.`updated_at` = '2023-07-05 15:10:32.815060' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:78:in `block in create_related_data'
  [1m[36mTRANSACTION (19.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:58:in `create_related_data'
Completed 201 in 481.74ms

Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-05 23:15:00 +0800

Started POST "/api/v1/return/return_book" at 2023-07-05 23:15:00 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (14.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `data_check'
  [1m[36mBook Load (1.1ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:49:in `data_check'
  [1m[36mAccount Load (4.1ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:52:in `data_check'
  [1m[36mOrder Load (0.7ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (11.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:29:in `perform'
  [1m[36mAccount Load (1.8ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:29:in `perform'
  [1m[36mOrder Update (7.6ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`estimated_return_time` = '2023-07-05 15:15:00', `orders`.`updated_at` = '2023-07-05 15:15:00.327439' WHERE `orders`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:29:in `perform'
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:29:in `perform'
  [1m[36mPayment Update All (3.7ms)[0m  [1m[33mUPDATE `payments` SET `payments`.`paid_amount` = 1.0, `payments`.`status` = 1 WHERE `payments`.`order_id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:76:in `deal_order_payments'
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:78:in `deal_order_payments'
  [1m[36mBook Update (1.0ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 9, `books`.`updated_at` = '2023-07-05 15:15:00.354499' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:78:in `deal_order_payments'
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:78:in `deal_order_payments'
Completed 201 in 189.81ms

  [1m[35m (2.4ms)[0m  [1m[34mSELECT GET_LOCK('5328620127835068540', 0)[0m
  [1m[35m (7.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (10.9ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (4.0ms)[0m  [1m[34mSELECT RELEASE_LOCK('5328620127835068540')[0m
  [1m[35m (2.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (9.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('5328620127835068540', 0)[0m
  [1m[35m (7.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.9ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('5328620127835068540')[0m
  [1m[35m (3.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (3.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (4.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('5328620127835068540', 0)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateDailyProfits (20230705042819)
  [1m[35m (181.3ms)[0m  [1m[35mDROP TABLE `daily_profits`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (6.0ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230705042819'[0m
Migrating to CreateHotBooks (20230705042635)
  [1m[35m (124.9ms)[0m  [1m[35mDROP TABLE `hot_books`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (2.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230705042635'[0m
Migrating to CreateAnnualSummaries (20230701101553)
  [1m[35m (64.9ms)[0m  [1m[35mDROP TABLE `annual_summaries`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (1.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101553'[0m
Migrating to CreateMonthlySummaries (20230701101547)
  [1m[35m (46.2ms)[0m  [1m[35mDROP TABLE `monthly_summaries`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (5.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101547'[0m
Migrating to CreateBooks (20230701101507)
  [1m[35m (88.4ms)[0m  [1m[35mDROP TABLE `books`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (1.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101507'[0m
Migrating to CreateOrders (20230701101503)
  [1m[35m (82.3ms)[0m  [1m[35mDROP TABLE `orders`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (2.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101503'[0m
Migrating to CreatePayments (20230701101455)
  [1m[35m (63.3ms)[0m  [1m[35mDROP TABLE `payments`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (15.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101455'[0m
Migrating to CreateUsers (20230701101004)
  [1m[35m (84.7ms)[0m  [1m[35mDROP TABLE `users`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (3.4ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701101004'[0m
Migrating to CreateAccounts (20230701100959)
  [1m[35m (58.0ms)[0m  [1m[35mDROP TABLE `accounts`[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20230701100959'[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT RELEASE_LOCK('5328620127835068540')[0m
  [1m[35m (5.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('5328620127835068540', 0)[0m
  [1m[35m (3.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateAccounts (20230701100959)
  [1m[35m (116.4ms)[0m  [1m[35mCREATE TABLE `accounts` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `status` int DEFAULT 0 NOT NULL COMMENT 'account status', `balance` float(24) DEFAULT 0.0 NOT NULL COMMENT 'balance', `user_id` int DEFAULT 0 NOT NULL COMMENT 'related user id', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (2.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701100959')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateUsers (20230701101004)
  [1m[35m (40.6ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `name` varchar(255) DEFAULT '' NOT NULL COMMENT 'user name', `email` varchar(255) DEFAULT '' NOT NULL COMMENT 'email', `phone` int DEFAULT 0 NOT NULL COMMENT 'phone', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101004')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePayments (20230701101455)
  [1m[35m (1.8ms)[0m  [1m[34mSELECT RELEASE_LOCK('5328620127835068540')[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('5328620127835068540', 0)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateOrders (20230701101503)
  [1m[35m (42.9ms)[0m  [1m[35mCREATE TABLE `orders` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `account_id` int NOT NULL COMMENT 'related account id', `status` int NOT NULL COMMENT 'order status', `book_id` int NOT NULL COMMENT 'related book id', `borrowed_at` datetime COMMENT 'books borrowed time', `estimated_return_time` datetime COMMENT 'books estimated time of return', `actual_return_time` datetime COMMENT 'Books actually return to time', `amount` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount paid', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (2.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101503')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateBooks (20230701101507)
  [1m[35m (28.1ms)[0m  [1m[35mCREATE TABLE `books` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `name` varchar(255) DEFAULT '' NOT NULL COMMENT 'book name', `author` varchar(255) DEFAULT '' NOT NULL COMMENT 'book author', `inventory` int DEFAULT 0 NOT NULL COMMENT 'inventory', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101507')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateMonthlySummaries (20230701101547)
  [1m[35m (35.0ms)[0m  [1m[35mCREATE TABLE `monthly_summaries` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` int NOT NULL COMMENT 'related user id', `month` int NOT NULL COMMENT 'month', `year` int NOT NULL COMMENT 'year', `amount_spent` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount spent', `number_of_borrow` int NOT NULL COMMENT 'user number of borrow on a month', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101547')[0m
  [1m[36mTRANSACTION (9.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateAnnualSummaries (20230701101553)
  [1m[35m (83.8ms)[0m  [1m[35mCREATE TABLE `annual_summaries` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` int NOT NULL COMMENT 'related user id', `year` int NOT NULL COMMENT 'year', `amount_spent` float(24) DEFAULT 0.0 NOT NULL COMMENT 'amount spent', `number_of_borrow` int DEFAULT 0 NOT NULL COMMENT 'user number of borrow on a year', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230701101553')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateHotBooks (20230705042635)
  [1m[35m (23.5ms)[0m  [1m[35mCREATE TABLE `hot_books` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `name` varchar(255) DEFAULT '' NOT NULL COMMENT 'book name', `author` varchar(255) DEFAULT '' NOT NULL COMMENT 'book author', `inventory` int DEFAULT 0 NOT NULL COMMENT 'inventory', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230705042635')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateDailyProfits (20230705042819)
  [1m[35m (24.9ms)[0m  [1m[35mCREATE TABLE `daily_profits` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `book_id` int NOT NULL COMMENT 'related book id', `year` int NOT NULL COMMENT 'related book id', `month` int NOT NULL COMMENT 'related book id', `day` int NOT NULL COMMENT 'related book id', `borrowed_day` datetime COMMENT 'books borrowed date', `amount` float(24) DEFAULT 0.0 NOT NULL COMMENT 'book profit amount', `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20230705042819')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('5328620127835068540')[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (2.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mDailyProfit Load (2.5ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` ORDER BY `daily_profits`.`id` DESC LIMIT 1[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (16.3ms)[0m  [1m[32mINSERT INTO `users` (`name`, `email`, `phone`, `created_at`, `updated_at`) VALUES ('Bob', 'bob@gamil.com', 123, '2023-07-08 11:43:44.912956', '2023-07-08 11:43:44.912956')[0m
  [1m[36mTRANSACTION (6.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (2.4ms)[0m  [1m[32mINSERT INTO `users` (`name`, `email`, `phone`, `created_at`, `updated_at`) VALUES ('Bill', 'bill@gamil.com', 123, '2023-07-08 11:43:44.964085', '2023-07-08 11:43:44.964085')[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAccount Create (4.7ms)[0m  [1m[32mINSERT INTO `accounts` (`status`, `balance`, `user_id`, `created_at`, `updated_at`) VALUES (1, 81.0, 1, '2023-07-08 11:43:44.992123', '2023-07-08 11:43:44.992123')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAccount Create (0.2ms)[0m  [1m[32mINSERT INTO `accounts` (`status`, `balance`, `user_id`, `created_at`, `updated_at`) VALUES (1, 51.0, 2, '2023-07-08 11:43:45.002036', '2023-07-08 11:43:45.002036')[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBook Create (6.2ms)[0m  [1m[32mINSERT INTO `books` (`name`, `author`, `inventory`, `created_at`, `updated_at`) VALUES ('A Brief History of Time: from the Big Bang to Black Holes', 'Stephen William Hawking', 10, '2023-07-08 11:43:45.045569', '2023-07-08 11:43:45.045569')[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBook Create (1.8ms)[0m  [1m[32mINSERT INTO `books` (`name`, `author`, `inventory`, `created_at`, `updated_at`) VALUES ('Star Trek', 'Eugene Wesley Roddenberry', 10, '2023-07-08 11:43:45.080350', '2023-07-08 11:43:45.080350')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=100" for ::1 at 2023-07-08 19:45:55 +0800
  [1m[35m (9.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-08 19:45:55 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "balance"=>"100"}
  [1m[36mUser Load (4.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (14.9ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mAccount Update (3.3ms)[0m  [1m[33mUPDATE `accounts` SET `accounts`.`balance` = 100.0, `accounts`.`updated_at` = '2023-07-08 11:45:55.504643' WHERE `accounts`.`id` = 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
Completed 201 in 494.8ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 19:46:02 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 19:46:02 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  NoMethodError: undefined method `id' for nil:NilClass
Completed 500 in 5.93ms

  
NoMethodError (undefined method `id' for nil:NilClass):
  
app/commands/v1/borrow/borrow_book_command.rb:101:in `book_redis_key'
app/commands/v1/borrow/borrow_book_command.rb:143:in `check_book_inventory'
app/commands/v1/borrow/borrow_book_command.rb:44:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 19:46:38 +0800
  [1m[35m (8.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 19:46:38 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  NoMethodError: undefined method `id' for nil:NilClass
Completed 500 in 65.32ms

  
NoMethodError (undefined method `id' for nil:NilClass):
  
app/commands/v1/borrow/borrow_book_command.rb:101:in `book_redis_key'
app/commands/v1/borrow/borrow_book_command.rb:143:in `check_book_inventory'
app/commands/v1/borrow/borrow_book_command.rb:44:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 19:48:20 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 19:48:20 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (2.1ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:132:in `find_book'
  [1m[36mAccount Load (1.7ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (10.6ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 11:48:20', '2023-07-08 11:48:20.518090', '2023-07-08 11:48:20.518090')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (4.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mDailyProfit Create (2.5ms)[0m  [1m[32mINSERT INTO `daily_profits` (`book_id`, `year`, `month`, `day`, `created_at`, `updated_at`) VALUES (1, 2023, 7, 8, '2023-07-08 11:48:20.551020', '2023-07-08 11:48:20.551020')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:78:in `block in create_related_data'
  [1m[36mMonthlySummary Load (2.8ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mTRANSACTION (5.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
  NoMethodError: undefined method `+' for nil:NilClass
Completed 500 in 204.23ms

  
NoMethodError (undefined method `+' for nil:NilClass):
  
app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:32:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:04:07 +0800
  
ActiveRecord::ConnectionNotEstablished (No connection pool for 'ApplicationRecord' found.):
  
activerecord (6.1.7.4) lib/active_record/connection_adapters/abstract/connection_pool.rb:1125:in `retrieve_connection'
activerecord (6.1.7.4) lib/active_record/connection_handling.rb:327:in `retrieve_connection'
activerecord (6.1.7.4) lib/active_record/connection_handling.rb:283:in `connection'
activerecord (6.1.7.4) lib/active_record/model_schema.rb:380:in `table_exists?'
activerecord (6.1.7.4) lib/active_record/migration.rb:1108:in `get_all_versions'
activerecord (6.1.7.4) lib/active_record/migration.rb:1121:in `needs_migration?'
activerecord (6.1.7.4) lib/active_record/migration.rb:625:in `check_pending!'
activerecord (6.1.7.4) lib/active_record/migration.rb:590:in `block (2 levels) in call'
activesupport (6.1.7.4) lib/active_support/evented_file_update_checker.rb:59:in `execute'
activesupport (6.1.7.4) lib/active_support/evented_file_update_checker.rb:65:in `execute_if_updated'
activerecord (6.1.7.4) lib/active_record/migration.rb:597:in `block in call'
activerecord (6.1.7.4) lib/active_record/migration.rb:587:in `synchronize'
activerecord (6.1.7.4) lib/active_record/migration.rb:587:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (6.1.7.4) lib/active_support/callbacks.rb:98:in `run_callbacks'
actionpack (6.1.7.4) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/debug_exceptions.rb:29:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/show_exceptions.rb:33:in `call'
railties (6.1.7.4) lib/rails/rack/logger.rb:37:in `call_app'
railties (6.1.7.4) lib/rails/rack/logger.rb:26:in `block in call'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (6.1.7.4) lib/rails/rack/logger.rb:26:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/remote_ip.rb:81:in `call'
request_store (1.5.1) lib/request_store/middleware.rb:19:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.7) lib/rack/runtime.rb:22:in `call'
activesupport (6.1.7.4) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/static.rb:24:in `call'
rack (2.2.7) lib/rack/sendfile.rb:110:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/host_authorization.rb:148:in `call'
railties (6.1.7.4) lib/rails/engine.rb:539:in `call'
puma (5.6.6) lib/puma/configuration.rb:252:in `call'
puma (5.6.6) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.6) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.6) lib/puma/request.rb:76:in `handle_request'
puma (5.6.6) lib/puma/server.rb:443:in `process_client'
puma (5.6.6) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:04:37 +0800
  [1m[35m (8.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:04:37 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (6.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  TypeError: no implicit conversion of Symbol into Integer
Completed 500 in 79.6ms

  
TypeError (no implicit conversion of Symbol into Integer):
  
app/commands/v1/borrow/borrow_book_command.rb:145:in `[]'
app/commands/v1/borrow/borrow_book_command.rb:145:in `check_book_inventory'
app/commands/v1/borrow/borrow_book_command.rb:44:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:06:00 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:06:00 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (13.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  TypeError: no implicit conversion of Symbol into Integer
Completed 500 in 16442.89ms

  
TypeError (no implicit conversion of Symbol into Integer):
  
app/commands/v1/borrow/borrow_book_command.rb:146:in `[]'
app/commands/v1/borrow/borrow_book_command.rb:146:in `check_book_inventory'
app/commands/v1/borrow/borrow_book_command.rb:44:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:09:36 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:09:37 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (16.5ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ (pry):8:in `check_book_inventory'
  NoMethodError: undefined method `<' for nil:NilClass
Completed 500 in 103100.87ms

  
NoMethodError (undefined method `<' for nil:NilClass):
  
app/commands/v1/borrow/borrow_book_command.rb:146:in `check_book_inventory'
app/commands/v1/borrow/borrow_book_command.rb:44:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:11:57 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:11:57 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (3.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  NoMethodError: undefined method `<' for nil:NilClass
Completed 500 in 73.76ms

  
NoMethodError (undefined method `<' for nil:NilClass):
  
app/commands/v1/borrow/borrow_book_command.rb:146:in `check_book_inventory'
app/commands/v1/borrow/borrow_book_command.rb:44:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:12:46 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:12:46 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (10.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  NoMethodError: undefined method `<' for nil:NilClass
Completed 500 in 10654.06ms

  
NoMethodError (undefined method `<' for nil:NilClass):
  
app/commands/v1/borrow/borrow_book_command.rb:146:in `check_book_inventory'
app/commands/v1/borrow/borrow_book_command.rb:44:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:13:43 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:13:43 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (139.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  TypeError: no implicit conversion of Symbol into Integer
Completed 500 in 188.97ms

  
TypeError (no implicit conversion of Symbol into Integer):
  
app/commands/v1/borrow/borrow_book_command.rb:128:in `[]'
app/commands/v1/borrow/borrow_book_command.rb:128:in `find_book'
app/commands/v1/borrow/borrow_book_command.rb:149:in `check_book_inventory'
app/commands/v1/borrow/borrow_book_command.rb:44:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:15:28 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:15:28 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (4.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (3.1ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:133:in `find_book'
  [1m[36mAccount Load (5.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (12.8ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:15:28', '2023-07-08 12:15:28.650735', '2023-07-08 12:15:28.650735')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (1.6ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mDailyProfit Create (2.9ms)[0m  [1m[32mINSERT INTO `daily_profits` (`book_id`, `year`, `month`, `day`, `created_at`, `updated_at`) VALUES (1, 2023, 7, 8, '2023-07-08 12:15:28.693694', '2023-07-08 12:15:28.693694')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:78:in `block in create_related_data'
  [1m[36mMonthlySummary Load (3.9ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
  NoMethodError: undefined method `+' for nil:NilClass
Completed 500 in 277.88ms

  
NoMethodError (undefined method `+' for nil:NilClass):
  
app/commands/v1/borrow/borrow_book_command.rb:88:in `block in create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:32:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:06 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:07 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (11.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (2.8ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (1.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (4.9ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:07', '2023-07-08 12:16:07.126633', '2023-07-08 12:16:07.126633')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (4.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mDailyProfit Create (2.1ms)[0m  [1m[32mINSERT INTO `daily_profits` (`book_id`, `year`, `month`, `day`, `created_at`, `updated_at`) VALUES (1, 2023, 7, 8, '2023-07-08 12:16:07.156056', '2023-07-08 12:16:07.156056')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:78:in `block in create_related_data'
  [1m[36mMonthlySummary Load (4.8ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Create (0.4ms)[0m  [1m[32mINSERT INTO `monthly_summaries` (`user_id`, `month`, `year`, `number_of_borrow`, `created_at`, `updated_at`) VALUES (1, 7, 2023, 1, '2023-07-08 12:16:07.184633', '2023-07-08 12:16:07.184633')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (4.2ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 99, `books`.`updated_at` = '2023-07-08 12:16:07.186873' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (4.8ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
  TypeError: no implicit conversion of Symbol into Integer
Completed 500 in 185.0ms

  
TypeError (no implicit conversion of Symbol into Integer):
  
app/commands/v1/borrow/borrow_book_command.rb:113:in `[]'
app/commands/v1/borrow/borrow_book_command.rb:113:in `deal_hot_book_data'
app/commands/v1/borrow/borrow_book_command.rb:93:in `block in create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:32:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:25 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:25 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (1.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (2.3ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:25', '2023-07-08 12:16:25.172209', '2023-07-08 12:16:25.172209')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (4.7ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mDailyProfit Create (3.0ms)[0m  [1m[32mINSERT INTO `daily_profits` (`book_id`, `year`, `month`, `day`, `created_at`, `updated_at`) VALUES (1, 2023, 7, 8, '2023-07-08 12:16:25.197033', '2023-07-08 12:16:25.197033')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:78:in `block in create_related_data'
  [1m[36mMonthlySummary Load (2.9ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Create (0.4ms)[0m  [1m[32mINSERT INTO `monthly_summaries` (`user_id`, `month`, `year`, `number_of_borrow`, `created_at`, `updated_at`) VALUES (1, 7, 2023, 1, '2023-07-08 12:16:25.215666', '2023-07-08 12:16:25.215666')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (2.1ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 99, `books`.`updated_at` = '2023-07-08 12:16:25.217691' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 578.32ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:35 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:35 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (4.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (1.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (14.4ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:35', '2023-07-08 12:16:35.745313', '2023-07-08 12:16:35.745313')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.5ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.7ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 2, `monthly_summaries`.`updated_at` = '2023-07-08 12:16:35.765676' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (1.0ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 98, `books`.`updated_at` = '2023-07-08 12:16:35.768907' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 44.05ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:36 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:36 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:36', '2023-07-08 12:16:36.836540', '2023-07-08 12:16:36.836540')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.9ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 3, `monthly_summaries`.`updated_at` = '2023-07-08 12:16:36.843238' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.6ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 97, `books`.`updated_at` = '2023-07-08 12:16:36.845854' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 22.81ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:37 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:37 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.7ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:37', '2023-07-08 12:16:37.987644', '2023-07-08 12:16:37.987644')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.6ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 4, `monthly_summaries`.`updated_at` = '2023-07-08 12:16:37.994336' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.5ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 96, `books`.`updated_at` = '2023-07-08 12:16:37.997439' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 25.55ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:38 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:38 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (1.7ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (3.8ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:38', '2023-07-08 12:16:38.894202', '2023-07-08 12:16:38.894202')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (2.2ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (3.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 5, `monthly_summaries`.`updated_at` = '2023-07-08 12:16:38.906618' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.5ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 95, `books`.`updated_at` = '2023-07-08 12:16:38.911470' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 35.44ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:39 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:39 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (1.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (1.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:39', '2023-07-08 12:16:39.692205', '2023-07-08 12:16:39.692205')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.5ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.5ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.2ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 6, `monthly_summaries`.`updated_at` = '2023-07-08 12:16:39.698660' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.3ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 94, `books`.`updated_at` = '2023-07-08 12:16:39.701232' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 23.91ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:40 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:40 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (1.1ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (3.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (2.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:40', '2023-07-08 12:16:40.498833', '2023-07-08 12:16:40.498833')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.6ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 7, `monthly_summaries`.`updated_at` = '2023-07-08 12:16:40.506628' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.5ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 93, `books`.`updated_at` = '2023-07-08 12:16:40.509928' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 31.46ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:41 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:41 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (4.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (1.7ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (6.3ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:41', '2023-07-08 12:16:41.294306', '2023-07-08 12:16:41.294306')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.5ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.4ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 8, `monthly_summaries`.`updated_at` = '2023-07-08 12:16:41.323714' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.5ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 92, `books`.`updated_at` = '2023-07-08 12:16:41.326620' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 53.0ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:42 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:42 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (2.7ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:42', '2023-07-08 12:16:42.107285', '2023-07-08 12:16:42.107285')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.1ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 9, `monthly_summaries`.`updated_at` = '2023-07-08 12:16:42.115254' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (1.0ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 91, `books`.`updated_at` = '2023-07-08 12:16:42.117760' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 22.87ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:42 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:42 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.4ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:42', '2023-07-08 12:16:42.873116', '2023-07-08 12:16:42.873116')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.4ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 10, `monthly_summaries`.`updated_at` = '2023-07-08 12:16:42.880114' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 90, `books`.`updated_at` = '2023-07-08 12:16:42.882029' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 22.79ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:16:43 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:16:43 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.4ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:16:43', '2023-07-08 12:16:43.652296', '2023-07-08 12:16:43.652296')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 11, `monthly_summaries`.`updated_at` = '2023-07-08 12:16:43.658930' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 89, `books`.`updated_at` = '2023-07-08 12:16:43.662288' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 26.67ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:20:35 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:20:35 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (11.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (8.1ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (9.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (1.8ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (15.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:20:35', '2023-07-08 12:20:35.730319', '2023-07-08 12:20:35.730319')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (11.8ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (9.5ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (4.6ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 12, `monthly_summaries`.`updated_at` = '2023-07-08 12:20:35.811046' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (1.0ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 88, `books`.`updated_at` = '2023-07-08 12:20:35.817353' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 226.81ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:20:49 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:20:49 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (6.6ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (9.4ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:20:49', '2023-07-08 12:20:49.855015', '2023-07-08 12:20:49.855015')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (8.2ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (11.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (2.9ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 13, `monthly_summaries`.`updated_at` = '2023-07-08 12:20:49.907082' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (1.0ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 87, `books`.`updated_at` = '2023-07-08 12:20:49.911995' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 30946.49ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:23:31 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:23:31 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (8.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (6.9ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (9.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (61.6ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:23:31', '2023-07-08 12:23:31.883685', '2023-07-08 12:23:31.883685')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (9.6ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (10.1ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.8ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 14, `monthly_summaries`.`updated_at` = '2023-07-08 12:23:32.017351' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (2.6ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 86, `books`.`updated_at` = '2023-07-08 12:23:32.021653' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 58267.0ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:26:05 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:26:05 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.5ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:26:05', '2023-07-08 12:26:05.969051', '2023-07-08 12:26:05.969051')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 15, `monthly_summaries`.`updated_at` = '2023-07-08 12:26:05.975109' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.3ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 85, `books`.`updated_at` = '2023-07-08 12:26:05.977365' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 30114.31ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:27:53 +0800
  [1m[35m (3.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:27:53 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.5ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (1.7ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.6ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:27:53', '2023-07-08 12:27:53.700373', '2023-07-08 12:27:53.700373')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (1.0ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (1.2ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 16, `monthly_summaries`.`updated_at` = '2023-07-08 12:27:53.745859' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (9.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 84, `books`.`updated_at` = '2023-07-08 12:27:53.748398' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 16726.13ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:28:24 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:28:24 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (5.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (8.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:136:in `find_book'
  [1m[36mAccount Load (4.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (10.4ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:28:24', '2023-07-08 12:28:24.742660', '2023-07-08 12:28:24.742660')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (2.9ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (3.2ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 17, `monthly_summaries`.`updated_at` = '2023-07-08 12:28:24.791130' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.9ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 83, `books`.`updated_at` = '2023-07-08 12:28:24.795937' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 97410.73ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:50 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:50 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (7.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (1.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.7ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:50', '2023-07-08 12:30:50.936575', '2023-07-08 12:30:50.936575')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (1.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mDailyProfit Create (0.9ms)[0m  [1m[32mINSERT INTO `daily_profits` (`book_id`, `year`, `month`, `day`, `created_at`, `updated_at`) VALUES (2, 2023, 7, 8, '2023-07-08 12:30:50.951517', '2023-07-08 12:30:50.951517')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:78:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 18, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:50.965508' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 19, `books`.`updated_at` = '2023-07-08 12:30:50.968587' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 124.91ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:51 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:51 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (3.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (1.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.7ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:51', '2023-07-08 12:30:51.661575', '2023-07-08 12:30:51.661575')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.6ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.9ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 19, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:51.671040' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.5ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 18, `books`.`updated_at` = '2023-07-08 12:30:51.674842' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 32.95ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:52 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:52 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (1.6ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.9ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:52', '2023-07-08 12:30:52.516587', '2023-07-08 12:30:52.516587')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.2ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.6ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.3ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 20, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:52.522129' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.2ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 17, `books`.`updated_at` = '2023-07-08 12:30:52.523609' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 19.92ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:53 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:53 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.6ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.3ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:53', '2023-07-08 12:30:53.181191', '2023-07-08 12:30:53.181191')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.8ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 21, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:53.187667' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.3ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 16, `books`.`updated_at` = '2023-07-08 12:30:53.191158' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 24.58ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:53 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:53 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.6ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (1.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:53', '2023-07-08 12:30:53.891056', '2023-07-08 12:30:53.891056')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (1.8ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.6ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 22, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:53.899255' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (1.6ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 15, `books`.`updated_at` = '2023-07-08 12:30:53.902721' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 29.46ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:54 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:54 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (2.1ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:54', '2023-07-08 12:30:54.542419', '2023-07-08 12:30:54.542419')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.2ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.2ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 23, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:54.548126' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.2ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 14, `books`.`updated_at` = '2023-07-08 12:30:54.550163' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 18.76ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:55 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:55 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.5ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:55', '2023-07-08 12:30:55.198627', '2023-07-08 12:30:55.198627')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.6ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.6ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.9ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 24, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:55.208077' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.5ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 13, `books`.`updated_at` = '2023-07-08 12:30:55.211657' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 25.91ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:55 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:55 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.9ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:55', '2023-07-08 12:30:55.908227', '2023-07-08 12:30:55.908227')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 25, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:55.915593' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 12, `books`.`updated_at` = '2023-07-08 12:30:55.918431' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 25.88ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:56 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:56 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.3ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:56', '2023-07-08 12:30:56.601402', '2023-07-08 12:30:56.601402')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.5ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.3ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 26, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:56.607390' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.2ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 11, `books`.`updated_at` = '2023-07-08 12:30:56.608664' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 15.84ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:57 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:57 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.9ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:57', '2023-07-08 12:30:57.291736', '2023-07-08 12:30:57.291736')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (14.2ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 27, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:57.296673' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.3ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 10, `books`.`updated_at` = '2023-07-08 12:30:57.312426' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 32.89ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:30:57 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:30:57 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (1.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:134:in `find_book'
  [1m[36mAccount Load (0.9ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.7ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:30:57', '2023-07-08 12:30:57.953898', '2023-07-08 12:30:57.953898')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (2.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 28, `monthly_summaries`.`updated_at` = '2023-07-08 12:30:57.960775' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.3ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 9, `books`.`updated_at` = '2023-07-08 12:30:57.963994' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 21.82ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:31:18 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:31:19 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (7.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (4.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (28.4ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:31:19', '2023-07-08 12:31:19.146114', '2023-07-08 12:31:19.146114')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (3.1ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (5.0ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (28.3ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 29, `monthly_summaries`.`updated_at` = '2023-07-08 12:31:19.209934' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (39.8ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 8, `books`.`updated_at` = '2023-07-08 12:31:19.240342' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 19612.31ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:12 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:12 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (5.1ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (7.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (12.5ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:12', '2023-07-08 12:32:12.261470', '2023-07-08 12:32:12.261470')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (6.0ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (6.7ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.1ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 30, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:12.309134' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (2.0ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 7, `books`.`updated_at` = '2023-07-08 12:32:12.312005' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 143.12ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:13 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:13 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (1.1ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.4ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:13', '2023-07-08 12:32:13.031431', '2023-07-08 12:32:13.031431')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 31, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:13.037370' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (1.0ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 6, `books`.`updated_at` = '2023-07-08 12:32:13.040167' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 23.79ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:13 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:13 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.9ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:13', '2023-07-08 12:32:13.965648', '2023-07-08 12:32:13.965648')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.2ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.2ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (2.3ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 32, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:13.970275' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.3ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 5, `books`.`updated_at` = '2023-07-08 12:32:13.973993' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 19.09ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:14 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:14 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.9ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:14', '2023-07-08 12:32:14.772747', '2023-07-08 12:32:14.772747')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 33, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:14.778296' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.2ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 4, `books`.`updated_at` = '2023-07-08 12:32:14.780401' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 17.35ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:15 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:15 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.8ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:15', '2023-07-08 12:32:15.506659', '2023-07-08 12:32:15.506659')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.9ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 34, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:15.512487' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.2ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 3, `books`.`updated_at` = '2023-07-08 12:32:15.514603' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 19.05ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:16 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:16 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.3ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:16', '2023-07-08 12:32:16.206634', '2023-07-08 12:32:16.206634')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (2.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 35, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:16.211576' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.9ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 2, `books`.`updated_at` = '2023-07-08 12:32:16.214877' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 18.42ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:16 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:16 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.5ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:16', '2023-07-08 12:32:16.921690', '2023-07-08 12:32:16.921690')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 36, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:16.929085' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 1, `books`.`updated_at` = '2023-07-08 12:32:16.931695' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 24.76ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:20 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:20 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (2.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:20', '2023-07-08 12:32:20.892285', '2023-07-08 12:32:20.892285')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.5ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 37, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:20.899256' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.3ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 0, `books`.`updated_at` = '2023-07-08 12:32:20.902225' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 21.23ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:21 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:21 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.5ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.3ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:21', '2023-07-08 12:32:21.633176', '2023-07-08 12:32:21.633176')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.2ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.1ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 38, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:21.638621' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (1.2ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = -1, `books`.`updated_at` = '2023-07-08 12:32:21.640744' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 20.95ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:22 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:22 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (1.1ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (3.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:22', '2023-07-08 12:32:22.484232', '2023-07-08 12:32:22.484232')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.6ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.5ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.2ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 39, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:22.495306' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = -2, `books`.`updated_at` = '2023-07-08 12:32:22.498148' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
  NameError: uninitialized constant Hotbook
Did you mean?  HotBook
Completed 500 in 32.4ms

  
NameError (uninitialized constant Hotbook
Did you mean?  HotBook):
  
app/commands/v1/borrow/borrow_book_command.rb:117:in `deal_hot_book_data'
app/commands/v1/borrow/borrow_book_command.rb:93:in `block in create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:32:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:23 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:23 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.8ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:23', '2023-07-08 12:32:23.118139', '2023-07-08 12:32:23.118139')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.2ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 39, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:23.124500' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = -2, `books`.`updated_at` = '2023-07-08 12:32:23.127505' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
  NameError: uninitialized constant Hotbook
Did you mean?  HotBook
Completed 500 in 25.01ms

  
NameError (uninitialized constant Hotbook
Did you mean?  HotBook):
  
app/commands/v1/borrow/borrow_book_command.rb:117:in `deal_hot_book_data'
app/commands/v1/borrow/borrow_book_command.rb:93:in `block in create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:32:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:32:39 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:32:39 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:135:in `find_book'
  [1m[36mAccount Load (1.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (2.7ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:32:39', '2023-07-08 12:32:39.284167', '2023-07-08 12:32:39.284167')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (1.7ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (1.5ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:80:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.7ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 39, `monthly_summaries`.`updated_at` = '2023-07-08 12:32:39.315383' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:87:in `block in create_related_data'
  [1m[36mBook Update (0.5ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = -2, `books`.`updated_at` = '2023-07-08 12:32:39.318853' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:92:in `block in create_related_data'
  [1m[36mHotBook Create (8.4ms)[0m  [1m[32mINSERT INTO `hot_books` (`id`, `name`, `author`, `inventory`, `created_at`, `updated_at`) VALUES (2, 'Star Trek', 'Eugene Wesley Roddenberry', -2, '2023-07-08 11:43:45.080350', '2023-07-08 12:32:39.318853')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:117:in `deal_hot_book_data'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 132.63ms

  [1m[36mOrder Load (2.4ms)[0m  [1m[34mSELECT `orders`.* FROM `orders`[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mOrder Destroy (3.0ms)[0m  [1m[31mDELETE FROM `orders` WHERE `orders`.`id` = 33[0m
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mOrder Destroy (0.8ms)[0m  [1m[31mDELETE FROM `orders` WHERE `orders`.`id` = 34[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mOrder Destroy (1.2ms)[0m  [1m[31mDELETE FROM `orders` WHERE `orders`.`id` = 35[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mOrder Destroy (0.3ms)[0m  [1m[31mDELETE FROM `orders` WHERE `orders`.`id` = 36[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mOrder Destroy (0.7ms)[0m  [1m[31mDELETE FROM `orders` WHERE `orders`.`id` = 37[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mOrder Destroy (2.0ms)[0m  [1m[31mDELETE FROM `orders` WHERE `orders`.`id` = 38[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mOrder Destroy (1.3ms)[0m  [1m[31mDELETE FROM `orders` WHERE `orders`.`id` = 39[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mOrder Destroy (0.8ms)[0m  [1m[31mDELETE FROM `orders` WHERE `orders`.`id` = 40[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mOrder Destroy (2.7ms)[0m  [1m[31mDELETE FROM `orders` WHERE `orders`.`id` = 41[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mOrder Destroy (1.3ms)[0m  [1m[31mDELETE FROM `orders` WHERE `orders`.`id` = 44[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:41:02 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:41:02 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.9ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:41:02', '2023-07-08 12:41:02.363423', '2023-07-08 12:41:02.363423')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (2.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (1.1ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.6ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 40, `monthly_summaries`.`updated_at` = '2023-07-08 12:41:02.395187' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (0.3ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 0, `books`.`updated_at` = '2023-07-08 12:41:02.397556' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 121.79ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:41:14 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:41:14 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (2.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (3.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (1.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (2.3ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-08 12:41:29', '2023-07-08 12:41:29.975685', '2023-07-08 12:41:29.975685')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (3.0ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (2.2ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 41, `monthly_summaries`.`updated_at` = '2023-07-08 12:41:30.011052' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (1.6ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = -1, `books`.`updated_at` = '2023-07-08 12:41:30.014984' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 15299.05ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=2" for ::1 at 2023-07-08 20:42:46 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:42:46 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  NoMethodError: undefined method `id' for nil:NilClass
Completed 500 in 3.58ms

  
NoMethodError (undefined method `id' for nil:NilClass):
  
app/commands/v1/borrow/borrow_book_command.rb:69:in `block in create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
app/commands/v1/borrow/borrow_book_command.rb:32:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=2" for ::1 at 2023-07-08 20:45:08 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:45:08 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  NoMethodError: undefined method `error' for V1::Borrow::BorrowBookCommandError:Class
Completed 500 in 82.5ms

  
NoMethodError (undefined method `error' for V1::Borrow::BorrowBookCommandError:Class):
  
app/commands/v1/borrow/borrow_book_command.rb:42:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=2" for ::1 at 2023-07-08 20:46:21 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:46:21 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"2"}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  V1::Borrow::BorrowBookCommandError: User does not exist
Completed 500 in 36.2ms

  
V1::Borrow::BorrowBookCommandError (User does not exist):
  
app/commands/v1/borrow/borrow_book_command.rb:42:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-08 20:46:58 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:46:58 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (1.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  V1::Borrow::BorrowBookCommandError: Insufficient stock
Completed 500 in 34.25ms

  
V1::Borrow::BorrowBookCommandError (Insufficient stock):
  
app/commands/v1/borrow/borrow_book_command.rb:154:in `check_book_inventory'
app/commands/v1/borrow/borrow_book_command.rb:44:in `data_check'
app/commands/v1/borrow/borrow_book_command.rb:31:in `perform'
app/api/v1/borrow_api.rb:28:in `block (2 levels) in <class:BorrowAPI>'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:33 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:33 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (5.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (3.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (8.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (5.7ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:33', '2023-07-08 12:48:33.770982', '2023-07-08 12:48:33.770982')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.8ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (2.9ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.8ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 42, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:33.842652' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (2.1ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 82, `books`.`updated_at` = '2023-07-08 12:48:33.847002' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 267.76ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:34 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:34 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.5ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (1.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (3.3ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:34', '2023-07-08 12:48:34.975322', '2023-07-08 12:48:34.975322')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (1.0ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.4ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 43, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:34.987098' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 81, `books`.`updated_at` = '2023-07-08 12:48:34.990311' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 37.09ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:35 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:35 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (2.1ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:35', '2023-07-08 12:48:35.902204', '2023-07-08 12:48:35.902204')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (1.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 44, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:35.911649' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 80, `books`.`updated_at` = '2023-07-08 12:48:35.914089' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 63.47ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:36 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:36 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.4ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:36', '2023-07-08 12:48:36.535709', '2023-07-08 12:48:36.535709')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.5ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.8ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 45, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:36.541546' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (0.6ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 79, `books`.`updated_at` = '2023-07-08 12:48:36.544771' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 27.5ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:37 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:37 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:37', '2023-07-08 12:48:37.312739', '2023-07-08 12:48:37.312739')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.1ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 46, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:37.319416' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (0.7ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 78, `books`.`updated_at` = '2023-07-08 12:48:37.322601' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 27.69ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:38 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:38 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.9ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:38', '2023-07-08 12:48:38.113630', '2023-07-08 12:48:38.113630')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.2ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 47, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:38.119433' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 77, `books`.`updated_at` = '2023-07-08 12:48:38.121315' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 20.63ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:38 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:38 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.9ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:38', '2023-07-08 12:48:38.804348', '2023-07-08 12:48:38.804348')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.5ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.9ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 48, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:38.811473' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (0.3ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 76, `books`.`updated_at` = '2023-07-08 12:48:38.813880' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 22.94ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:39 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:39 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.6ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.7ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.8ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:39', '2023-07-08 12:48:39.562657', '2023-07-08 12:48:39.562657')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.1ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 49, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:39.570808' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (0.6ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 75, `books`.`updated_at` = '2023-07-08 12:48:39.573926' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 32.84ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:40 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:40 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.1ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:40', '2023-07-08 12:48:40.325693', '2023-07-08 12:48:40.325693')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 50, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:40.331607' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 74, `books`.`updated_at` = '2023-07-08 12:48:40.333984' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 43.72ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:41 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:41 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (7.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:41', '2023-07-08 12:48:41.148045', '2023-07-08 12:48:41.148045')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.4ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 51, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:41.170473' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 73, `books`.`updated_at` = '2023-07-08 12:48:41.174999' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mHotBook Create (20.7ms)[0m  [1m[32mINSERT INTO `hot_books` (`id`, `name`, `author`, `inventory`, `created_at`, `updated_at`) VALUES (1, 'A Brief History of Time: from the Big Bang to Black Holes', 'Stephen William Hawking', 73, '2023-07-08 11:43:45.045569', '2023-07-08 12:48:41.174999')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:121:in `deal_hot_book_data'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 146.13ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 20:48:42 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:48:42 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mHotBook Load (0.3ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:139:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (0.9ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 12:48:42', '2023-07-08 12:48:42.199950', '2023-07-08 12:48:42.199950')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Load (1.0ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`number_of_borrow` = 52, `monthly_summaries`.`updated_at` = '2023-07-08 12:48:42.215607' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mHotBook Update (1.7ms)[0m  [1m[33mUPDATE `hot_books` SET `hot_books`.`inventory` = 72, `hot_books`.`updated_at` = '2023-07-08 12:48:42.224100' WHERE `hot_books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 68.16ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=1" for ::1 at 2023-07-08 20:55:46 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 20:55:46 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (3.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
Completed 201 in 47.27ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=1" for ::1 at 2023-07-08 21:18:57 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 21:18:57 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (3.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
Completed 201 in 63.1ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=1" for ::1 at 2023-07-08 21:23:57 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 21:23:57 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
Completed 201 in 30.81ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 21:24:05 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 21:24:05 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mHotBook Load (17.9ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:142:in `find_book'
  [1m[36mAccount Load (2.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (16.8ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `amount`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 13:24:06', 1.0, '2023-07-08 13:24:06.087925', '2023-07-08 13:24:06.087925')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (2.5ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mDailyProfit Update (2.3ms)[0m  [1m[33mUPDATE `daily_profits` SET `daily_profits`.`amount` = 1.0, `daily_profits`.`updated_at` = '2023-07-08 13:24:06.125402' WHERE `daily_profits`.`id` = 4[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:81:in `block in create_related_data'
  [1m[36mMonthlySummary Load (2.3ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`amount_spent` = 1.0, `monthly_summaries`.`number_of_borrow` = 53, `monthly_summaries`.`updated_at` = '2023-07-08 13:24:06.143854' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mHotBook Update (0.6ms)[0m  [1m[33mUPDATE `hot_books` SET `hot_books`.`inventory` = 71, `hot_books`.`updated_at` = '2023-07-08 13:24:06.145962' WHERE `hot_books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 181.37ms

Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 21:25:05 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 21:25:06 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (5.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:58:in `data_check'
  [1m[36mBook Load (2.9ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:61:in `data_check'
  [1m[36mAccount Load (2.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:64:in `data_check'
  [1m[36mOrder Load (3.4ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mOrder Update (5.0ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`status` = 1, `orders`.`estimated_return_time` = '2023-07-08 13:25:06', `orders`.`amount` = 1.0, `orders`.`updated_at` = '2023-07-08 13:25:06.203017' WHERE `orders`.`id` = 47[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `perform'
  [1m[36mBook Update (0.7ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 74, `books`.`updated_at` = '2023-07-08 13:25:06.214056' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `perform'
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `perform'
  NoMethodError: undefined method `-' for nil:NilClass
Completed 500 in 156.61ms

  
NoMethodError (undefined method `-' for nil:NilClass):
  
app/commands/v1/return/return_book_command.rb:45:in `perform'
app/api/v1/return_api.rb:27:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=12&book_id=1" for ::1 at 2023-07-08 21:30:06 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 21:30:06 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (3.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:58:in `data_check'
  NoMethodError: undefined method `error' for V1::Return::ReturnBookCommandError:Class
Completed 500 in 41.65ms

  
NoMethodError (undefined method `error' for V1::Return::ReturnBookCommandError:Class):
  
app/commands/v1/return/return_book_command.rb:59:in `data_check'
app/commands/v1/return/return_book_command.rb:25:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=12&book_id=1" for ::1 at 2023-07-08 21:30:26 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 21:30:27 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:58:in `data_check'
Completed 201 in 29.07ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 21:52:38 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 21:52:38 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (6.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mHotBook Load (5.8ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:22:in `find_book'
Completed 201 in 218.78ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-08 21:53:15 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-08 21:53:15 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (3.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mHotBook Load (3.6ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:22:in `find_book'
  [1m[36mAccount Load (1.9ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (4.2ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `amount`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-08 13:53:15', 1.0, '2023-07-08 13:53:15.481223', '2023-07-08 13:53:15.481223')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (1.1ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 8 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mDailyProfit Update (1.9ms)[0m  [1m[33mUPDATE `daily_profits` SET `daily_profits`.`amount` = 2.0, `daily_profits`.`updated_at` = '2023-07-08 13:53:15.507332' WHERE `daily_profits`.`id` = 4[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:81:in `block in create_related_data'
  [1m[36mMonthlySummary Load (3.2ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (0.5ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`amount_spent` = 2.0, `monthly_summaries`.`number_of_borrow` = 54, `monthly_summaries`.`updated_at` = '2023-07-08 13:53:15.532713' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mHotBook Update (1.9ms)[0m  [1m[33mUPDATE `hot_books` SET `hot_books`.`inventory` = 70, `hot_books`.`updated_at` = '2023-07-08 13:53:15.535788' WHERE `hot_books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 215.84ms

Started POST "/api/v1/return/return_book?user_id=12&book_id=1" for ::1 at 2023-07-08 22:32:39 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:32:39 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (3.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/application_command.rb:19:in `data_check'
  NameError: undefined local variable or method `user' for #<V1::Return::ReturnBookCommand:0x00007fb86d660a58>
Did you mean?  @user
Completed 500 in 86.74ms

  
NameError (undefined local variable or method `user' for #<V1::Return::ReturnBookCommand:0x00007fb86d660a58>
Did you mean?  @user):
  
app/commands/application_command.rb:20:in `data_check'
app/commands/v1/return/return_book_command.rb:25:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=12&book_id=1" for ::1 at 2023-07-08 22:33:21 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:33:21 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/application_command.rb:19:in `data_check'
  NameError: uninitialized constant ApplicationCommand::ReturnBookCommandError
Completed 500 in 73.41ms

  
NameError (uninitialized constant ApplicationCommand::ReturnBookCommandError):
  
app/commands/application_command.rb:20:in `data_check'
app/commands/v1/return/return_book_command.rb:25:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=12&book_id=1" for ::1 at 2023-07-08 22:34:00 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:34:00 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/application_command.rb:19:in `data_check'
  ApplicationCommandError: User does not exist
Completed 500 in 46.59ms

  
ApplicationCommandError (User does not exist):
  
app/commands/application_command.rb:20:in `data_check'
app/commands/v1/return/return_book_command.rb:25:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=12&book_id=1" for ::1 at 2023-07-08 22:34:17 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:34:17 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (75.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/application_command.rb:20:in `data_check'
  ApplicationCommandError: User does not exist
Completed 500 in 6280.5ms

  
ApplicationCommandError (User does not exist):
  
app/commands/application_command.rb:21:in `data_check'
app/commands/v1/return/return_book_command.rb:25:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=12&book_id=1" for ::1 at 2023-07-08 22:35:39 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:35:39 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (8.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/application_command.rb:20:in `data_check'
  NameError: uninitialized constant V1::ApplicationCommandError
Completed 500 in 4015.25ms

  
NameError (uninitialized constant V1::ApplicationCommandError):
  
app/api/v1/return_api.rb:28:in `rescue in block (2 levels) in <class:ReturnAPI>'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=12&book_id=1" for ::1 at 2023-07-08 22:36:08 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:36:08 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/application_command.rb:20:in `data_check'
Completed 201 in 2730.33ms

Started POST "/api/v1/return/return_book?user_id=12&book_id=1" for ::1 at 2023-07-08 22:36:39 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:36:39 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"12", "book_id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/application_command.rb:19:in `data_check'
Completed 201 in 28.46ms

Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 22:38:00 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:38:00 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:19:in `data_check'
  [1m[36mAccount Load (4.8ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mHotBook Load (2.0ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:40:in `find_book'
  NameError: undefined local variable or method `account' for #<V1::Return::ReturnBookCommand:0x00007fb86536b8f0>
Did you mean?  @account
               amount
Completed 500 in 86.72ms

  
NameError (undefined local variable or method `account' for #<V1::Return::ReturnBookCommand:0x00007fb86536b8f0>
Did you mean?  @account
               amount):
  
app/commands/v1/return/return_book_command.rb:26:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 22:38:22 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:38:22 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:19:in `data_check'
  [1m[36mAccount Load (2.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mHotBook Load (5.3ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:40:in `find_book'
  [1m[36mOrder Load (3.6ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  NameError: undefined local variable or method `borrowed_at' for #<V1::Return::ReturnBookCommand:0x00007fb864ae9128>
Completed 500 in 127.79ms

  
NameError (undefined local variable or method `borrowed_at' for #<V1::Return::ReturnBookCommand:0x00007fb864ae9128>):
  
app/commands/v1/return/return_book_command.rb:32:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 22:38:53 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:38:53 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (3.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:19:in `data_check'
  [1m[36mAccount Load (4.1ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mHotBook Load (3.9ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:40:in `find_book'
  [1m[36mOrder Load (2.9ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  NoMethodError: undefined method `ComputeAmountCommand' for V1::Borrow:Module
Completed 500 in 174.44ms

  
NoMethodError (undefined method `ComputeAmountCommand' for V1::Borrow:Module):
  
app/commands/v1/return/return_book_command.rb:31:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 22:58:50 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:58:50 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (7.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:19:in `data_check'
  [1m[36mAccount Load (13.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mHotBook Load (56.8ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:40:in `find_book'
  [1m[36mOrder Load (1.0ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:37:in `perform'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:37:in `perform'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/commands/v1/return/return_book_command.rb:37:in `perform'
  NoMethodError: undefined method `to_f' for #<V1::Borrow::ComputeAmountCommand:0x00007fb8642bd738>
Did you mean?  to_s
Completed 500 in 521.68ms

  
NoMethodError (undefined method `to_f' for #<V1::Borrow::ComputeAmountCommand:0x00007fb8642bd738>
Did you mean?  to_s):
  
app/commands/v1/return/return_book_command.rb:37:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 22:59:43 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 22:59:43 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:19:in `data_check'
  [1m[36mAccount Load (1.8ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mHotBook Load (1.6ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:40:in `find_book'
  [1m[36mOrder Load (0.9ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (11.3ms)[0m  [1m[35mBEGIN[0m
  ↳ (pry):17:in `perform'
  [1m[36mAccount Load (1.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ (pry):17:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ (pry):17:in `perform'
  NoMethodError: undefined method `to_f' for #<V1::Borrow::ComputeAmountCommand:0x00007fb86d58dc98>
Did you mean?  to_s
Completed 500 in 210537.85ms

  
NoMethodError (undefined method `to_f' for #<V1::Borrow::ComputeAmountCommand:0x00007fb86d58dc98>
Did you mean?  to_s):
  
app/commands/v1/return/return_book_command.rb:38:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 23:03:21 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 23:03:22 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:19:in `data_check'
  [1m[36mAccount Load (1.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mHotBook Load (21.4ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:40:in `find_book'
  [1m[36mOrder Load (1.4ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  NameError: uninitialized constant ApplicationCommand::DAILY_CONSUMPTION
Completed 500 in 136.48ms

  
NameError (uninitialized constant ApplicationCommand::DAILY_CONSUMPTION):
  
app/commands/application_command.rb:82:in `compute_amount'
app/commands/v1/return/return_book_command.rb:31:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 23:04:07 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 23:04:07 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:20:in `data_check'
  [1m[36mAccount Load (4.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:22:in `data_check'
  [1m[36mHotBook Load (2.2ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Load (9.5ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mOrder Update (4.7ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`estimated_return_time` = '2023-07-08 15:04:07', `orders`.`amount` = 8583.0, `orders`.`updated_at` = '2023-07-08 15:04:07.583121' WHERE `orders`.`id` = 47[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mTRANSACTION (6.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mHotBook Update (3.0ms)[0m  [1m[33mUPDATE `hot_books` SET `hot_books`.`inventory` = 71, `hot_books`.`updated_at` = '2023-07-08 15:04:07.600253' WHERE `hot_books`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  NoMethodError: undefined method `-' for #<Account:0x00007fb86d125cf0>
Completed 500 in 121.52ms

  
NoMethodError (undefined method `-' for #<Account:0x00007fb86d125cf0>):
  
app/commands/v1/return/return_book_command.rb:54:in `perform'
app/api/v1/return_api.rb:26:in `block (2 levels) in <class:ReturnAPI>'
Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 23:04:36 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 23:04:36 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:20:in `data_check'
  [1m[36mAccount Load (3.9ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:22:in `data_check'
  [1m[36mHotBook Load (1.9ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Load (0.5ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mOrder Update (4.2ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`estimated_return_time` = '2023-07-08 15:04:36', `orders`.`updated_at` = '2023-07-08 15:04:36.933686' WHERE `orders`.`id` = 47[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mTRANSACTION (19.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mHotBook Update (13.6ms)[0m  [1m[33mUPDATE `hot_books` SET `hot_books`.`inventory` = 72, `hot_books`.`updated_at` = '2023-07-08 15:04:36.959511' WHERE `hot_books`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
  [1m[36mAccount Update (3.0ms)[0m  [1m[33mUPDATE `accounts` SET `accounts`.`balance` = 0.0, `accounts`.`updated_at` = '2023-07-08 15:04:36.977642' WHERE `accounts`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
Completed 201 in 181.33ms

Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 23:05:59 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 23:05:59 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:20:in `data_check'
  [1m[36mAccount Load (2.7ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:22:in `data_check'
  [1m[36mHotBook Load (0.5ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Load (3.1ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mOrder Update (1.4ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`estimated_return_time` = '2023-07-08 15:05:59', `orders`.`amount` = 1.0, `orders`.`updated_at` = '2023-07-08 15:06:37.778072' WHERE `orders`.`id` = 47[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `perform'
  [1m[36mHotBook Update (10.1ms)[0m  [1m[33mUPDATE `hot_books` SET `hot_books`.`inventory` = 73, `hot_books`.`updated_at` = '2023-07-08 15:06:37.784050' WHERE `hot_books`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `perform'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `perform'
Completed 201 in 38112.62ms

Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 23:08:05 +0800
  [1m[35m (3.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/return/return_book" at 2023-07-08 23:08:05 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:20:in `data_check'
  [1m[36mAccount Load (1.9ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:22:in `data_check'
  [1m[36mHotBook Load (4.4ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Load (1.5ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 AND `orders`.`status` = 0 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mOrder Update (4.2ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`status` = 1, `orders`.`estimated_return_time` = '2023-07-08 15:08:05', `orders`.`amount` = 1.0, `orders`.`updated_at` = '2023-07-08 15:08:05.507540' WHERE `orders`.`id` = 48[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:36:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `perform'
  [1m[36mHotBook Update (2.6ms)[0m  [1m[33mUPDATE `hot_books` SET `hot_books`.`inventory` = 74, `hot_books`.`updated_at` = '2023-07-08 15:08:05.515836' WHERE `hot_books`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `perform'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:43:in `perform'
Completed 201 in 436.36ms

Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-08 23:08:56 +0800

Started POST "/api/v1/return/return_book" at 2023-07-08 23:08:56 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:20:in `data_check'
  [1m[36mAccount Load (3.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:22:in `data_check'
  [1m[36mHotBook Load (12.4ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Load (0.5ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`book_id` = 1 AND `orders`.`account_id` = 1 AND `orders`.`status` = 0 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:26:in `perform'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:37:in `perform'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:37:in `perform'
  [1m[36mOrder Update (4.2ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`status` = 1, `orders`.`estimated_return_time` = '2023-07-08 15:09:11', `orders`.`amount` = 1.0, `orders`.`updated_at` = '2023-07-08 15:09:11.680851' WHERE `orders`.`id` = 49[0m
  ↳ app/commands/v1/return/return_book_command.rb:37:in `perform'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:37:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:44:in `perform'
  [1m[36mHotBook Update (0.5ms)[0m  [1m[33mUPDATE `hot_books` SET `hot_books`.`inventory` = 75, `hot_books`.`updated_at` = '2023-07-08 15:09:11.689019' WHERE `hot_books`.`id` = 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:44:in `perform'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:44:in `perform'
Completed 201 in 15410.14ms

Started GET "/api/v1/user/info/search?user_id=1" for ::1 at 2023-07-08 23:19:40 +0800

Started GET "/api/v1/user/info/search" at 2023-07-08 23:19:41 +0800
Processing by V1::UserAPI/user/info/search
  Parameters: {"user_id"=>"1"}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:24:in `perform'
  [1m[36mAccount Load (3.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:25:in `perform'
Completed 200 in 67.9ms

  [1m[36mOrder Load (4.3ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`account_id` = 1[0m
  ↳ app/api/response_info.rb:42:in `to_json'
Started GET "/api/v1/book/search_book_income?book_id=1" for ::1 at 2023-07-08 23:20:33 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-08 23:20:33 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"1"}
  [1m[36mHotBook Load (1.6ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:63:in `deal_query_time'
  NameError: uninitialized constant V1::Return::SearchCommandError
Completed 500 in 27.77ms

  
NameError (uninitialized constant V1::Return::SearchCommandError):
  
app/api/v1/book_api.rb:29:in `rescue in block (2 levels) in <class:BookAPI>'
app/api/v1/book_api.rb:27:in `block (2 levels) in <class:BookAPI>'
Started GET "/api/v1/book/search_book_income?book_id=1" for ::1 at 2023-07-08 23:20:48 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-08 23:20:48 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"1"}
  [1m[36mHotBook Load (430.7ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Exists? (18.4ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:63:in `deal_query_time'
  NoMethodError: undefined method `daily_profits' for #<HotBook:0x00007f7962dc94b0>
Completed 500 in 504.29ms

  
NoMethodError (undefined method `daily_profits' for #<HotBook:0x00007f7962dc94b0>):
  
app/commands/v1/book/search_command.rb:66:in `deal_query_time'
app/commands/v1/book/search_command.rb:48:in `compute_book_amount'
app/commands/v1/book/search_command.rb:28:in `perform'
app/api/v1/book_api.rb:27:in `block (2 levels) in <class:BookAPI>'
Started GET "/api/v1/book/search_book_income?book_id=1" for ::1 at 2023-07-08 23:20:54 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-08 23:20:54 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"1"}
  [1m[36mHotBook Load (0.4ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:63:in `deal_query_time'
  NoMethodError: undefined method `daily_profits' for #<HotBook:0x00007f796285c720>
Completed 500 in 12.59ms

  
NoMethodError (undefined method `daily_profits' for #<HotBook:0x00007f796285c720>):
  
app/commands/v1/book/search_command.rb:66:in `deal_query_time'
app/commands/v1/book/search_command.rb:48:in `compute_book_amount'
app/commands/v1/book/search_command.rb:28:in `perform'
app/api/v1/book_api.rb:27:in `block (2 levels) in <class:BookAPI>'
Started GET "/api/v1/book/search_book_income?book_id=1" for ::1 at 2023-07-08 23:21:20 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-08 23:21:20 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"1"}
  [1m[36mHotBook Load (2.5ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:63:in `deal_query_time'
  NoMethodError: undefined method `orders' for #<HotBook:0x00007f795aa608d0>
Completed 500 in 48.21ms

  
NoMethodError (undefined method `orders' for #<HotBook:0x00007f795aa608d0>):
  
app/commands/v1/book/search_command.rb:67:in `deal_query_time'
app/commands/v1/book/search_command.rb:48:in `compute_book_amount'
app/commands/v1/book/search_command.rb:28:in `perform'
app/api/v1/book_api.rb:27:in `block (2 levels) in <class:BookAPI>'
Started GET "/api/v1/book/search_book_income?book_id=1" for ::1 at 2023-07-08 23:22:02 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-08 23:22:02 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"1"}
  [1m[36mHotBook Load (1.9ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:63:in `deal_query_time'
  [1m[35m (2.8ms)[0m  [1m[34mSELECT SUM(`daily_profits`.`amount`) FROM `daily_profits` WHERE `daily_profits`.`hot_book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:50:in `compute_book_amount'
  [1m[35m (0.4ms)[0m  [1m[34mSELECT SUM(`orders`.`amount`) FROM `orders` WHERE `orders`.`hot_book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:55:in `compute_book_amount'
Completed 200 in 54.26ms

Started GET "/api/v1/book/search_book_income?book_id=1" for ::1 at 2023-07-08 23:23:25 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-08 23:23:25 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"1"}
  [1m[36mHotBook Load (0.3ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:63:in `deal_query_time'
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM(`daily_profits`.`amount`) FROM `daily_profits` WHERE `daily_profits`.`hot_book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:50:in `compute_book_amount'
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM(`orders`.`amount`) FROM `orders` WHERE `orders`.`hot_book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:55:in `compute_book_amount'
Completed 200 in 23571.55ms

Started GET "/api/v1/book/search_book_income?book_id=1" for ::1 at 2023-07-08 23:23:59 +0800
  [1m[35m (6.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started GET "/api/v1/book/search_book_income" at 2023-07-08 23:23:59 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"1"}
  [1m[36mHotBook Load (1.1ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:63:in `deal_query_time'
  [1m[36mDailyProfit Load (1.6ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`hot_book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:90:in `deal_query_time'
  [1m[36mDailyProfit Load (0.5ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`hot_book_id` = 1 /* loading for inspect */ LIMIT 11[0m
  ↳ app/commands/v1/book/search_command.rb:90:in `deal_query_time'
  [1m[36mDailyProfit Load (0.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`hot_book_id` = 1 ORDER BY `daily_profits`.`id` DESC LIMIT 1[0m
  ↳ (pry):2:in `deal_query_time'
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `daily_profits` WHERE `daily_profits`.`hot_book_id` = 1[0m
  ↳ (pry):3:in `deal_query_time'
  [1m[36mDailyProfit Load (0.5ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`hot_book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:90:in `deal_query_time'
  [1m[36mDailyProfit Load (0.3ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`hot_book_id` = 1 /* loading for inspect */ LIMIT 11[0m
  ↳ app/commands/v1/book/search_command.rb:90:in `deal_query_time'
  [1m[35m (4.4ms)[0m  [1m[34mSELECT SUM(`daily_profits`.`amount`) FROM `daily_profits` WHERE `daily_profits`.`hot_book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:50:in `compute_book_amount'
  [1m[35m (1.7ms)[0m  [1m[34mSELECT SUM(`orders`.`amount`) FROM `orders` WHERE `orders`.`hot_book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:55:in `compute_book_amount'
Completed 200 in 142756.33ms

Started GET "/api/v1/book/search_book_income?book_id=1" for ::1 at 2023-07-08 23:26:31 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-08 23:26:31 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"1"}
  [1m[36mHotBook Load (0.5ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:63:in `deal_query_time'
  [1m[36mDailyProfit Load (3.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:90:in `deal_query_time'
  [1m[35m (4.7ms)[0m  [1m[34mSELECT SUM(`daily_profits`.`amount`) FROM `daily_profits` WHERE `daily_profits`.`book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:50:in `compute_book_amount'
  [1m[35m (0.4ms)[0m  [1m[34mSELECT SUM(`orders`.`amount`) FROM `orders` WHERE `orders`.`book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:55:in `compute_book_amount'
Completed 200 in 11937.14ms

Started GET "/api/v1/book/search_book_income?book_id=1" for ::1 at 2023-07-08 23:27:55 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-08 23:27:55 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"1"}
  [1m[36mHotBook Load (0.7ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mOrder Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:63:in `deal_query_time'
  [1m[35m (3.7ms)[0m  [1m[34mSELECT SUM(`daily_profits`.`amount`) FROM `daily_profits` WHERE `daily_profits`.`book_id` = 1[0m
  ↳ app/commands/v1/book/search_command.rb:50:in `compute_book_amount'
Completed 200 in 53.74ms

  [1m[36mUser Load (9.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` ORDER BY `users`.`id` DESC LIMIT 1[0m
  [1m[36mOrder Load (18.7ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`user_id` = 2[0m
  [1m[36mOrder Load (6.4ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`user_id` = 2 /* loading for inspect */ LIMIT 11[0m
  [1m[36mAccount Load (3.8ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 2 LIMIT 1[0m
  [1m[36mOrder Load (11.9ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`account_id` = 2[0m
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-09 14:06:06 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 14:06:06 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mHotBook Load (3.1ms)[0m  [1m[34mSELECT `hot_books`.* FROM `hot_books` WHERE `hot_books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
Completed 201 in 232.04ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-09 14:09:09 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 14:09:09 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (16.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mAccount Load (3.8ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
Completed 201 in 179.59ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=100" for ::1 at 2023-07-09 14:10:19 +0800

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-09 14:10:19 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "balance"=>"100"}
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (0.9ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mTRANSACTION (4.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mAccount Update (17.5ms)[0m  [1m[33mUPDATE `accounts` SET `accounts`.`balance` = 100.0, `accounts`.`updated_at` = '2023-07-09 06:10:19.356337' WHERE `accounts`.`id` = 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mTRANSACTION (25.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
Completed 201 in 119.63ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=1" for ::1 at 2023-07-09 14:10:25 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 14:10:25 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (2.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mAccount Load (1.0ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:66:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:66:in `block in create_related_data'
  [1m[36mOrder Create (20.2ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `amount`, `created_at`, `updated_at`) VALUES (1, 0, 1, '2023-07-09 06:10:25', 1.0, '2023-07-09 06:10:25.944026', '2023-07-09 06:10:25.944026')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:66:in `block in create_related_data'
  [1m[36mDailyProfit Load (9.4ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 9 AND `daily_profits`.`book_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:75:in `block in create_related_data'
  [1m[36mDailyProfit Create (23.1ms)[0m  [1m[32mINSERT INTO `daily_profits` (`book_id`, `year`, `month`, `day`, `amount`, `created_at`, `updated_at`) VALUES (1, 2023, 7, 9, 1.0, '2023-07-09 06:10:26.031083', '2023-07-09 06:10:26.031083')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:79:in `block in create_related_data'
  [1m[36mMonthlySummary Load (49.9ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:81:in `block in create_related_data'
  [1m[36mMonthlySummary Update (2.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`amount_spent` = 3.0, `monthly_summaries`.`number_of_borrow` = 55, `monthly_summaries`.`updated_at` = '2023-07-09 06:10:26.197815' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:88:in `block in create_related_data'
  [1m[36mBook Update (0.3ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 73, `books`.`updated_at` = '2023-07-09 06:10:26.202263' WHERE `books`.`id` = 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:93:in `block in create_related_data'
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 352.36ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2&estimated_return_time=2023-07-19T14:10:25.000+08:00" for ::1 at 2023-07-09 14:11:41 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 14:11:41 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2", "estimated_return_time"=>"2023-07-19T14:10:25.000 08:00"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (0.9ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:66:in `block in create_related_data'
  [1m[36mAccount Load (0.9ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:66:in `block in create_related_data'
  [1m[36mOrder Create (3.0ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `estimated_return_time`, `amount`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-09 06:11:41', '2023-07-19 06:10:25', 1.0, '2023-07-09 06:11:41.595274', '2023-07-09 06:11:41.595274')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:66:in `block in create_related_data'
  [1m[36mDailyProfit Load (1.8ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 9 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:75:in `block in create_related_data'
  [1m[36mDailyProfit Create (1.1ms)[0m  [1m[32mINSERT INTO `daily_profits` (`book_id`, `year`, `month`, `day`, `amount`, `created_at`, `updated_at`) VALUES (2, 2023, 7, 9, 1.0, '2023-07-09 06:11:41.612076', '2023-07-09 06:11:41.612076')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:79:in `block in create_related_data'
  [1m[36mMonthlySummary Load (0.5ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:81:in `block in create_related_data'
  [1m[36mMonthlySummary Update (2.0ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`amount_spent` = 4.0, `monthly_summaries`.`number_of_borrow` = 56, `monthly_summaries`.`updated_at` = '2023-07-09 06:11:41.617476' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:88:in `block in create_related_data'
  [1m[36mBook Update (4.1ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 9, `books`.`updated_at` = '2023-07-09 06:11:41.621784' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:93:in `block in create_related_data'
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:60:in `create_related_data'
Completed 201 in 57.02ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2&estimated_return_time=2023-07-19T14:10:25.000+08:00" for ::1 at 2023-07-09 14:12:14 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 14:12:15 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2", "estimated_return_time"=>"2023-07-19T14:10:25.000 08:00"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (2.8ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2&estimated_return_time=2023-07-19T14:10:25.000+08:00" for ::1 at 2023-07-09 14:13:52 +0800
  [1m[35m (2.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 14:13:52 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2", "estimated_return_time"=>"2023-07-19T14:10:25.000 08:00"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (2.5ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mAccount Load (1.1ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2&estimated_return_time=2023-07-19T14:10:25.000+08:00" for ::1 at 2023-07-09 14:14:54 +0800
  [1m[35m (3.8ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 14:14:54 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2", "estimated_return_time"=>"2023-07-19T14:10:25.000 08:00"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (3.1ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mAccount Load (1.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
Completed 201 in 44355.24ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2&estimated_return_time=2023-07-19T14:10:25.000+08:00" for ::1 at 2023-07-09 14:15:56 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 14:15:56 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2", "estimated_return_time"=>"2023-07-19T14:10:25.000 08:00"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
  [1m[36mBook Load (2.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/application_command.rb:41:in `find_book'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:46:in `data_check'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mOrder Create (1.5ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `estimated_return_time`, `amount`, `created_at`, `updated_at`) VALUES (1, 0, 2, '2023-07-09 06:15:56', '2023-07-19 06:10:25', 10.0, '2023-07-09 06:15:56.205898', '2023-07-09 06:15:56.205898')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:68:in `block in create_related_data'
  [1m[36mDailyProfit Load (2.8ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 9 AND `daily_profits`.`book_id` = 2 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mDailyProfit Update (2.9ms)[0m  [1m[33mUPDATE `daily_profits` SET `daily_profits`.`amount` = 11.0, `daily_profits`.`updated_at` = '2023-07-09 06:15:56.225531' WHERE `daily_profits`.`id` = 7[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:81:in `block in create_related_data'
  [1m[36mMonthlySummary Load (3.2ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:83:in `block in create_related_data'
  [1m[36mMonthlySummary Update (1.8ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`amount_spent` = 14.0, `monthly_summaries`.`number_of_borrow` = 57, `monthly_summaries`.`updated_at` = '2023-07-09 06:15:56.250924' WHERE `monthly_summaries`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:90:in `block in create_related_data'
  [1m[36mBook Update (2.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 8, `books`.`updated_at` = '2023-07-09 06:15:56.254694' WHERE `books`.`id` = 2[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:95:in `block in create_related_data'
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:61:in `create_related_data'
Completed 201 in 135.72ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=2" for ::1 at 2023-07-09 15:13:57 +0800
  
ActiveRecord::ConnectionNotEstablished (No connection pool for 'ApplicationRecord' found.):
  
activerecord (6.1.7.4) lib/active_record/connection_adapters/abstract/connection_pool.rb:1125:in `retrieve_connection'
activerecord (6.1.7.4) lib/active_record/connection_handling.rb:327:in `retrieve_connection'
activerecord (6.1.7.4) lib/active_record/connection_handling.rb:283:in `connection'
activerecord (6.1.7.4) lib/active_record/model_schema.rb:380:in `table_exists?'
activerecord (6.1.7.4) lib/active_record/migration.rb:1108:in `get_all_versions'
activerecord (6.1.7.4) lib/active_record/migration.rb:1121:in `needs_migration?'
activerecord (6.1.7.4) lib/active_record/migration.rb:625:in `check_pending!'
activerecord (6.1.7.4) lib/active_record/migration.rb:590:in `block (2 levels) in call'
activesupport (6.1.7.4) lib/active_support/evented_file_update_checker.rb:59:in `execute'
activesupport (6.1.7.4) lib/active_support/evented_file_update_checker.rb:65:in `execute_if_updated'
activerecord (6.1.7.4) lib/active_record/migration.rb:597:in `block in call'
activerecord (6.1.7.4) lib/active_record/migration.rb:587:in `synchronize'
activerecord (6.1.7.4) lib/active_record/migration.rb:587:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (6.1.7.4) lib/active_support/callbacks.rb:98:in `run_callbacks'
actionpack (6.1.7.4) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/debug_exceptions.rb:29:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/show_exceptions.rb:33:in `call'
railties (6.1.7.4) lib/rails/rack/logger.rb:37:in `call_app'
railties (6.1.7.4) lib/rails/rack/logger.rb:26:in `block in call'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (6.1.7.4) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (6.1.7.4) lib/rails/rack/logger.rb:26:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/remote_ip.rb:81:in `call'
request_store (1.5.1) lib/request_store/middleware.rb:19:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.7) lib/rack/runtime.rb:22:in `call'
activesupport (6.1.7.4) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/static.rb:24:in `call'
rack (2.2.7) lib/rack/sendfile.rb:110:in `call'
actionpack (6.1.7.4) lib/action_dispatch/middleware/host_authorization.rb:148:in `call'
railties (6.1.7.4) lib/rails/engine.rb:539:in `call'
puma (5.6.6) lib/puma/configuration.rb:252:in `call'
puma (5.6.6) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.6) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.6) lib/puma/request.rb:76:in `handle_request'
puma (5.6.6) lib/puma/server.rb:443:in `process_client'
puma (5.6.6) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=2" for ::1 at 2023-07-09 15:14:05 +0800
  [1m[35m (5.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 15:14:05 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"2"}
  [1m[36mUser Load (3.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:41:in `data_check'
Completed 201 in 50.83ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=12&book_id=2" for ::1 at 2023-07-09 17:57:25 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 17:57:25 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"12", "book_id"=>"2"}
  [1m[36mUser Load (2.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
Completed 201 in 84.89ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-09 17:57:30 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 17:57:30 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
Completed 201 in 4.84ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-09 17:57:34 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 17:57:34 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
Completed 201 in 3.5ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-09 18:49:56 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 18:49:56 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (4.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
Completed 201 in 63.27ms

  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (11.3ms)[0m  [1m[32mINSERT INTO `users` (`name`, `email`, `phone`, `created_at`, `updated_at`) VALUES ('Bob', 'bob@gamil.com', 123, '2023-07-09 10:52:33.323578', '2023-07-09 10:52:33.323578')[0m
  [1m[36mTRANSACTION (9.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO `users` (`name`, `email`, `phone`, `created_at`, `updated_at`) VALUES ('Bill', 'bill@gamil.com', 123, '2023-07-09 10:52:33.366078', '2023-07-09 10:52:33.366078')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (14.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (3.7ms)[0m  [1m[34mSELECT `users`.* FROM `users` ORDER BY `users`.`id` DESC LIMIT 1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 70 LIMIT 1[0m
  [1m[36mAccount Create (8.0ms)[0m  [1m[32mINSERT INTO `accounts` (`status`, `balance`, `user_id`, `created_at`, `updated_at`) VALUES (1, 58.0, 70, '2023-07-09 10:53:50.365776', '2023-07-09 10:53:50.365776')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 71 LIMIT 1[0m
  [1m[36mAccount Create (1.3ms)[0m  [1m[32mINSERT INTO `accounts` (`status`, `balance`, `user_id`, `created_at`, `updated_at`) VALUES (1, 75.0, 71, '2023-07-09 10:53:50.379240', '2023-07-09 10:53:50.379240')[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBook Create (3.6ms)[0m  [1m[32mINSERT INTO `books` (`name`, `author`, `inventory`, `created_at`, `updated_at`) VALUES ('A Brief History of Time: from the Big Bang to Black Holes', 'Stephen William Hawking', 10, '2023-07-09 10:53:50.401686', '2023-07-09 10:53:50.401686')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBook Create (0.8ms)[0m  [1m[32mINSERT INTO `books` (`name`, `author`, `inventory`, `created_at`, `updated_at`) VALUES ('Star Trek', 'Eugene Wesley Roddenberry', 10, '2023-07-09 10:53:50.408628', '2023-07-09 10:53:50.408628')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users`[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Update (2.6ms)[0m  [1m[33mUPDATE `users` SET `users`.`id` = 1, `users`.`updated_at` = '2023-07-09 10:54:19.130888' WHERE `users`.`id` = 70[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Update (5.9ms)[0m  [1m[33mUPDATE `users` SET `users`.`id` = 2, `users`.`updated_at` = '2023-07-09 10:54:28.587209' WHERE `users`.`id` = 71[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts`[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mAccount Update (2.0ms)[0m  [1m[33mUPDATE `accounts` SET `accounts`.`user_id` = 1, `accounts`.`updated_at` = '2023-07-09 10:55:23.457918' WHERE `accounts`.`id` = 172[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mAccount Update (0.5ms)[0m  [1m[33mUPDATE `accounts` SET `accounts`.`user_id` = 2, `accounts`.`updated_at` = '2023-07-09 10:55:23.495788' WHERE `accounts`.`id` = 173[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT[0m
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=2" for ::1 at 2023-07-09 18:55:48 +0800
  [1m[35m (2.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 18:55:48 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"2"}
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mAccount Load (1.6ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:24:in `data_check'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 2 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
Completed 201 in 99.07ms

  [1m[36mBook Load (2.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` ORDER BY `books`.`id` DESC LIMIT 1[0m
Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=43" for ::1 at 2023-07-09 18:56:11 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-09 18:56:11 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"43"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:24:in `data_check'
  [1m[36mBook Load (0.2ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
  [1m[36mCACHE Book Load (0.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:62:in `block in create_related_data'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 172 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:62:in `block in create_related_data'
  [1m[36mCACHE Book Load (0.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:62:in `block in create_related_data'
  [1m[36mOrder Create (2.7ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `amount`, `created_at`, `updated_at`) VALUES (172, 0, 43, '2023-07-09 10:56:11', 1.0, '2023-07-09 10:56:11.839152', '2023-07-09 10:56:11.839152')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:62:in `block in create_related_data'
  [1m[36mDailyProfit Load (0.5ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 9 AND `daily_profits`.`book_id` = 43 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:71:in `block in create_related_data'
  [1m[36mDailyProfit Create (1.1ms)[0m  [1m[32mINSERT INTO `daily_profits` (`book_id`, `year`, `month`, `day`, `amount`, `created_at`, `updated_at`) VALUES (43, 2023, 7, 9, 1.0, '2023-07-09 10:56:11.855080', '2023-07-09 10:56:11.855080')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:75:in `block in create_related_data'
  [1m[36mMonthlySummary Load (3.1ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Create (1.7ms)[0m  [1m[32mINSERT INTO `monthly_summaries` (`user_id`, `month`, `year`, `amount_spent`, `number_of_borrow`, `created_at`, `updated_at`) VALUES (1, 7, 2023, 1.0, 1, '2023-07-09 10:56:11.879085', '2023-07-09 10:56:11.879085')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:84:in `block in create_related_data'
  [1m[36mBook Update (0.5ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 9, `books`.`updated_at` = '2023-07-09 10:56:11.882483' WHERE `books`.`id` = 43[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:89:in `block in create_related_data'
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:56:in `create_related_data'
Completed 201 in 468.46ms

Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-09 18:56:19 +0800

Started POST "/api/v1/return/return_book" at 2023-07-09 18:56:19 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  Grape::Exceptions::ValidationErrors: order_id is missing
Completed 500 in 7.46ms

Started POST "/api/v1/return/return_book?user_id=1&book_id=1" for ::1 at 2023-07-09 18:56:45 +0800

Started POST "/api/v1/return/return_book" at 2023-07-09 18:56:45 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"1"}
  [1m[36mUser Load (5.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mAccount Load (2.7ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:24:in `data_check'
  [1m[36mBook Load (1.9ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
Completed 201 in 118.31ms

Started POST "/api/v1/return/return_book?user_id=1&book_id=43" for ::1 at 2023-07-09 18:56:52 +0800

Started POST "/api/v1/return/return_book" at 2023-07-09 18:56:52 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"43"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mAccount Load (0.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:24:in `data_check'
  [1m[36mBook Load (0.9ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
  [1m[36mOrder Load (4.4ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`account_id` = 172 AND `orders`.`status` = 0 AND `orders`.`book_id` = 43 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:30:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 172 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mCACHE Book Load (0.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mOrder Update (1.3ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`status` = 1, `orders`.`actual_return_time` = '2023-07-09 10:56:52', `orders`.`updated_at` = '2023-07-09 10:56:52.578344' WHERE `orders`.`id` = 41[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mBook Update (4.6ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 10, `books`.`updated_at` = '2023-07-09 10:56:52.584783' WHERE `books`.`id` = 43[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
  [1m[36mAccount Update (1.5ms)[0m  [1m[33mUPDATE `accounts` SET `accounts`.`balance` = 57.0, `accounts`.`updated_at` = '2023-07-09 10:56:52.596892' WHERE `accounts`.`id` = 172[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
Completed 201 in 57.18ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=100" for ::1 at 2023-07-09 23:24:34 +0800
  [1m[35m (5.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-09 23:24:34 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "balance"=>"100"}
  [1m[36mUser Load (12.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (1.2ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mAccount Update (1.8ms)[0m  [1m[33mUPDATE `accounts` SET `accounts`.`balance` = 100.0, `accounts`.`updated_at` = '2023-07-09 15:24:34.743942' WHERE `accounts`.`id` = 172[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
  [1m[36mTRANSACTION (4.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:28:in `perform'
Completed 201 in 466.43ms

Started GET "/api/v1/book/search_book_income?book_id=1" for ::1 at 2023-07-09 23:24:50 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-09 23:24:50 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"1"}
  [1m[36mBook Load (75.6ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
Completed 200 in 120.97ms

Started GET "/api/v1/book/search_book_income?book_id=32" for ::1 at 2023-07-09 23:24:57 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-09 23:24:57 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"32"}
  [1m[36mBook Load (0.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 32 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
Completed 200 in 2.17ms

Started GET "/api/v1/book/search_book_income?book_id=42" for ::1 at 2023-07-09 23:25:11 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-09 23:25:11 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"42"}
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 42 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
  [1m[36mOrder Exists? (4.8ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 42 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:60:in `deal_query_time'
Completed 200 in 31.34ms

Started GET "/api/v1/user/info/search?user_id=1" for ::1 at 2023-07-09 23:25:46 +0800

Started GET "/api/v1/user/info/search" at 2023-07-09 23:25:46 +0800
Processing by V1::UserAPI/user/info/search
  Parameters: {"user_id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:24:in `perform'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:25:in `perform'
Completed 200 in 30.06ms

  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`account_id` = 172[0m
  ↳ app/api/response_info.rb:42:in `to_json'
Started GET "/api/v1/book/search_book_income?book_id=42" for ::1 at 2023-07-10 00:54:57 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-10 00:54:57 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"42"}
  [1m[36mBook Load (20.7ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 42 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
  [1m[36mOrder Exists? (5.2ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 42 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:52:in `deal_query_time'
Completed 200 in 257.09ms

Started GET "/api/v1/book/search_book_income" for ::1 at 2023-07-10 00:56:32 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-10 00:56:32 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {}
  Grape::Exceptions::ValidationErrors: book_id is missing, book_id is empty
Completed 500 in 71.98ms

Started POST "/api/v1/user/manage/set_user_amount?user_id=1&balance=100" for ::1 at 2023-07-10 01:53:38 +0800
  [1m[35m (7.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m

Started POST "/api/v1/user/manage/set_user_amount" at 2023-07-10 01:53:39 +0800
Processing by V1::UserAPI/user/manage/set_user_amount
  Parameters: {"user_id"=>"1", "balance"=>"100"}
  [1m[36mUser Load (6.5ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:25:in `perform'
  [1m[36mAccount Load (6.8ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:26:in `perform'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:26:in `perform'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:26:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/user/manage/set_user_amount_command.rb:26:in `perform'
Completed 201 in 552.75ms

Started POST "/api/v1/borrow/create_borrow_book_order?user_id=1&book_id=43" for ::1 at 2023-07-10 01:53:43 +0800

Started POST "/api/v1/borrow/create_borrow_book_order" at 2023-07-10 01:53:43 +0800
Processing by V1::BorrowAPI/borrow/create_borrow_book_order
  Parameters: {"user_id"=>"1", "book_id"=>"43"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:24:in `data_check'
  [1m[36mBook Load (3.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
  [1m[36mCACHE Book Load (0.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:62:in `block in create_related_data'
  [1m[36mAccount Load (0.5ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 172 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:62:in `block in create_related_data'
  [1m[36mCACHE Book Load (0.1ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:62:in `block in create_related_data'
  [1m[36mOrder Create (11.6ms)[0m  [1m[32mINSERT INTO `orders` (`account_id`, `status`, `book_id`, `borrowed_at`, `amount`, `created_at`, `updated_at`) VALUES (172, 0, 43, '2023-07-09 17:53:43', 1.0, '2023-07-09 17:53:43.409597', '2023-07-09 17:53:43.409597')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:62:in `block in create_related_data'
  [1m[36mDailyProfit Load (5.6ms)[0m  [1m[34mSELECT `daily_profits`.* FROM `daily_profits` WHERE `daily_profits`.`year` = 2023 AND `daily_profits`.`month` = 7 AND `daily_profits`.`day` = 10 AND `daily_profits`.`book_id` = 43 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:71:in `block in create_related_data'
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:75:in `block in create_related_data'
  [1m[36mDailyProfit Create (1.6ms)[0m  [1m[32mINSERT INTO `daily_profits` (`book_id`, `year`, `month`, `day`, `amount`, `created_at`, `updated_at`) VALUES (43, 2023, 7, 10, 1.0, '2023-07-09 17:53:43.446276', '2023-07-09 17:53:43.446276')[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:75:in `block in create_related_data'
  [1m[36mMonthlySummary Load (6.9ms)[0m  [1m[34mSELECT `monthly_summaries`.* FROM `monthly_summaries` WHERE `monthly_summaries`.`user_id` = 1 AND `monthly_summaries`.`month` = 7 AND `monthly_summaries`.`year` = 2023 LIMIT 1[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:77:in `block in create_related_data'
  [1m[36mMonthlySummary Update (3.4ms)[0m  [1m[33mUPDATE `monthly_summaries` SET `monthly_summaries`.`amount_spent` = 2.0, `monthly_summaries`.`number_of_borrow` = 2, `monthly_summaries`.`updated_at` = '2023-07-09 17:53:43.473467' WHERE `monthly_summaries`.`id` = 34[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:84:in `block in create_related_data'
  [1m[36mBook Update (1.5ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 9, `books`.`updated_at` = '2023-07-09 17:53:43.478441' WHERE `books`.`id` = 43[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:89:in `block in create_related_data'
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/borrow/borrow_book_command.rb:56:in `create_related_data'
Completed 201 in 127.6ms

Started POST "/api/v1/return/return_book?user_id=1&book_id=43" for ::1 at 2023-07-10 01:53:46 +0800

Started POST "/api/v1/return/return_book" at 2023-07-10 01:53:46 +0800
Processing by V1::ReturnAPI/return/return_book
  Parameters: {"user_id"=>"1", "book_id"=>"43"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:21:in `data_check'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/application_command.rb:24:in `data_check'
  [1m[36mBook Load (0.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
  [1m[36mOrder Load (2.0ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`account_id` = 172 AND `orders`.`status` = 0 AND `orders`.`book_id` = 43 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:30:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mAccount Load (0.3ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 172 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mCACHE Book Load (0.0ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mOrder Update (2.1ms)[0m  [1m[33mUPDATE `orders` SET `orders`.`status` = 1, `orders`.`actual_return_time` = '2023-07-09 17:53:46', `orders`.`updated_at` = '2023-07-09 17:53:46.519609' WHERE `orders`.`id` = 42[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:39:in `perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mBook Update (0.4ms)[0m  [1m[33mUPDATE `books` SET `books`.`inventory` = 10, `books`.`updated_at` = '2023-07-09 17:53:46.525712' WHERE `books`.`id` = 43[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:46:in `perform'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
  [1m[36mAccount Update (1.3ms)[0m  [1m[33mUPDATE `accounts` SET `accounts`.`balance` = 99.0, `accounts`.`updated_at` = '2023-07-09 17:53:46.536514' WHERE `accounts`.`id` = 172[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/commands/v1/return/return_book_command.rb:57:in `perform'
Completed 201 in 34.3ms

Started GET "/api/v1/user/info/search?user_id=1" for ::1 at 2023-07-10 01:53:49 +0800

Started GET "/api/v1/user/info/search" at 2023-07-10 01:53:49 +0800
Processing by V1::UserAPI/user/info/search
  Parameters: {"user_id"=>"1"}
  [1m[36mUser Load (3.3ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:24:in `perform'
  [1m[36mAccount Load (0.4ms)[0m  [1m[34mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 1 LIMIT 1[0m
  ↳ app/commands/v1/user/info/search_command.rb:25:in `perform'
Completed 200 in 15.24ms

  [1m[36mOrder Load (0.5ms)[0m  [1m[34mSELECT `orders`.* FROM `orders` WHERE `orders`.`account_id` = 172[0m
  ↳ app/api/response_info.rb:38:in `to_json'
Started GET "/api/v1/book/search_book_income" for ::1 at 2023-07-10 01:53:52 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-10 01:53:52 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {}
  Grape::Exceptions::ValidationErrors: book_id is missing, book_id is empty
Completed 500 in 3.84ms

Started GET "/api/v1/book/search_book_income?book_id=42" for ::1 at 2023-07-10 01:53:57 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-10 01:53:57 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"42"}
  [1m[36mBook Load (0.4ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 42 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
  [1m[36mOrder Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 42 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:52:in `deal_query_time'
Completed 200 in 6.78ms

Started GET "/api/v1/book/search_book_income?book_id=43" for ::1 at 2023-07-10 01:54:19 +0800

Started GET "/api/v1/book/search_book_income" at 2023-07-10 01:54:19 +0800
Processing by V1::BookAPI/book/search_book_income
  Parameters: {"book_id"=>"43"}
  [1m[36mBook Load (0.3ms)[0m  [1m[34mSELECT `books`.* FROM `books` WHERE `books`.`id` = 43 LIMIT 1[0m
  ↳ app/commands/application_command.rb:43:in `find_book'
  [1m[36mOrder Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `orders` WHERE `orders`.`book_id` = 43 LIMIT 1[0m
  ↳ app/commands/v1/book/search_command.rb:52:in `deal_query_time'
  [1m[35m (1.1ms)[0m  [1m[34mSELECT SUM(`daily_profits`.`amount`) FROM `daily_profits` WHERE `daily_profits`.`book_id` = 43[0m
  ↳ app/commands/v1/book/search_command.rb:38:in `compute_book_amount'
Completed 200 in 5.76ms

